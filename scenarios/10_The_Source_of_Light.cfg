#textdomain wesnoth-Invasion_from_the_Unknown

[scenario]
    id=10_The_Source_of_Light
    name= _ "The Source of Light"
    {MAP 10_The_Source_of_Light.map}
    {TURNS 60 59 58}
    next_scenario=10x_Elynia
    victory_when_enemies_defeated=no

    #
    # TODO: the berserker potion is too hard to reach with elves
    #

    {SCENARIO_MUSIC "nunc_dimittis.ogg"}

    {DEEP_UNDERGROUND}

    [time_area]
        x=41-69,43-69,37-40,44-52,46-50,48,58-61,60,41-42
        y=38-44,45-61,56-59,   37,   36,35,   37,36,56-61
        {UNDERGROUND_VOLCANO_DEFAULT}
    [/time_area]

    {STORYTXT_THE_SOURCE_OF_LIGHT}

    {DEATHS_ACT_2_1}
    {DEATHS_DWARVES}

    # wmllint: validate-off
    [side]
        side=1
        controller=human
        team_name=heroes
        user_team_name= _ "team_name^Elves"

        shroud=yes

        {GOLD 200 180 170}
        {INCOME 5 4 3}

        # wmllint: recognize Galas
        {CHARACTER_STATS_GALAS}
    [/side]
    # wmllint: validate-on

#define TSOL_SENTRY _TYPE _X _Y
    [unit]
        type={_TYPE}
        x={_X}
        y={_Y}
        random_traits=yes
        generate_name=yes
        random_gender=yes
        ai_special=guardian
    [/unit]
#enddef

    # Chaos incursion remnants
    [side]
        side=2
        team_name=gaia
        user_team_name= _ "team_name^Chaos Empire"
        {CHAOS_FLAG}

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            #{AI_SIMPLE_ALWAYS_ASPECT leader_ignores_keep yes}
            {AI_SIMPLE_ALWAYS_ASPECT leader_aggression   1.0}
            {AI_SIMPLE_ALWAYS_ASPECT aggression          1.0}
            {AI_SIMPLE_ALWAYS_ASPECT village_value       0.0}
        [/ai]

        canrecruit=yes
        type=Demon Warrior
        id=Mena
        name= _ "Mena"
        gender=female
        ai_special=guardian
        experience=112
        [modifications]
            {TRAIT_DEXTROUS}
            {TRAIT_STRONG}
        [/modifications]

        {TSOL_SENTRY ({DIFF (Iron Golem) Goliath Goliath}) 33 22}
        [+unit]
            experience=96
        [/unit]

        {TSOL_SENTRY Automaton 35 23}
        {TSOL_SENTRY Automaton 35 20}

        {TSOL_SENTRY (Demon Grunt) 32 21}
        {TSOL_SENTRY (Demon Grunt) 38 20}

        {TSOL_SENTRY (Demon Zephyr) 33 24}
        {TSOL_SENTRY (Demon Zephyr) 38 23}

        {TSOL_SENTRY (Chaos Marauder) 34 23}
        {TSOL_SENTRY (Chaos Magus)    36 23}
    [/side]

#ifdef HARD

#define TSOL_DZOMBIE
    Soulless
#enddef

#else

#define TSOL_DZOMBIE
    Walking Corpse
#enddef

#endif

    # Undead in NE tunnels and central chamber
    [side]
        side=3
        team_name=gaia
        user_team_name= _ "team_name^Cave Creatures"
        {RAGGED_FLAG}

        no_leader=yes
        hidden=yes

        recruit=Walking Corpse,Soulless,Vampire Bat,Ghost,Mudcrawler

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value                 0.40}
            {AI_SIMPLE_ALWAYS_ASPECT grouping                      defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression                    0.80}
            {AI_SIMPLE_ALWAYS_ASPECT caution                       0.00}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_combat yes}
        [/ai]

        # Roaming fossils in the central chamber
        {TSOL_SENTRY Soulless 28 31} {VARIATION wose}
        {TSOL_SENTRY Soulless 30 25} {VARIATION wose}
        {TSOL_SENTRY Soulless 35 25} {VARIATION wose}
        {TSOL_SENTRY Soulless 41 26} {VARIATION wose}
        {TSOL_SENTRY Soulless 41 32} {VARIATION wose}
        {TSOL_SENTRY Soulless 36 34} {VARIATION wose}
#ifdef 0
        #
        # FIXME: this breaks and throws a bunch of errors on AI turn 1.
        #
        {SIDE_MICRO_AI 3 patrol (
            [filter]
                [filter_wml]
                    variation=wose
                [/filter_wml]
            [/filter]
            waypoint_x=35,29,29,35,41,41
            waypoint_y=35,32,26,23,26,32
        )}
#endif

        {TSOL_SENTRY {TSOL_DZOMBIE} 55 27} {VARIATION bat} {FACING se}
        {TSOL_SENTRY {TSOL_DZOMBIE} 59 31} {VARIATION bat} {FACING se}
        {TSOL_SENTRY {TSOL_DZOMBIE} 54 33} {VARIATION bat} {FACING nw}

        {TSOL_SENTRY Soulless 56 28} {VARIATION troll}

        {TSOL_SENTRY Soulless 66 33} {VARIATION bat}

        {TSOL_SENTRY (Vampire Bat) 50 16}
        {TSOL_SENTRY (Vampire Bat) 51 17}
        {TSOL_SENTRY (Vampire Bat) 52 16}

        {TSOL_SENTRY (Blood Bat) 67 18}

        {TSOL_SENTRY (Revenant) 61 18} {FACING se}
        {TSOL_SENTRY (Revenant) 64 20} {FACING nw}

        {TSOL_SENTRY {DIFF Ghoul Ghoul Necrophage} 55 21} {FACING nw}

        {TSOL_SENTRY (Vampire Bat) 22 59}
        {TSOL_SENTRY (Vampire Bat) 30 57}
        {TSOL_SENTRY (Vampire Bat)  6 59}
    [/side]

    {RECRUIT_UNIT_VARIATIONS 3 "Walking Corpse,Soulless" saurian}

    # Fire spirits in SE tunnels
    [side]
        side=4
        team_name=gaia
        user_team_name= _ "team_name^Cave Creatures"
        {RAGGED_FLAG}

        no_leader=yes
        hidden=yes

        recruit=Fire Wisp,Fire Spirit

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value                 0.00}
            {AI_SIMPLE_ALWAYS_ASPECT grouping                      defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression                    1.00}
            {AI_SIMPLE_ALWAYS_ASPECT caution                       0.00}
        [/ai]

        {TSOL_SENTRY (Fire Spirit) 45 39}
        {TSOL_SENTRY (Fire Spirit) 48 36}
        {TSOL_SENTRY (Fire Spirit) 60 43}
        {TSOL_SENTRY (Fire Spirit) 62 48}
        {TSOL_SENTRY (Fire Spirit) 53 55}
        {TSOL_SENTRY (Fire Spirit) 47 51}

        {TSOL_SENTRY (Fire Wisp) 52 47}
        {TSOL_SENTRY (Fire Wisp) 46 43}
        {TSOL_SENTRY (Fire Wisp) 57 41}
        {TSOL_SENTRY (Fire Wisp) 58 39}
        {TSOL_SENTRY (Fire Wisp) 65 57}
        {TSOL_SENTRY (Fire Wisp) 68 52}
    [/side]

    # Ghosts in SW tunnels
    [side]
        side=5
        team_name=gaia
        user_team_name= _ "team_name^Cave Creatures"
        {RAGGED_FLAG}

        no_leader=yes
        hidden=yes

        recruit=Ghost,Animated Rock,Mudcrawler,Walking Corpse,Giant Leech

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value                 0.00}
            {AI_SIMPLE_ALWAYS_ASPECT grouping                      defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression                    1.00}
            {AI_SIMPLE_ALWAYS_ASPECT caution                       0.00}
        [/ai]

        {TSOL_SENTRY Wraith 11 49}
        {TSOL_SENTRY Wraith 17 49}
#ifndef EASY
        {TSOL_SENTRY Wraith 16 52}
#endif

        {TSOL_SENTRY (Rock Golem)  9 45}
        {TSOL_SENTRY (Rock Golem) 17 43}
        {TSOL_SENTRY (Rock Golem) 13 39}
        {TSOL_SENTRY (Rock Golem) 25 38}
        {TSOL_SENTRY (Rock Golem) 32 45}
        {TSOL_SENTRY (Rock Golem) 41 47}
    [/side]

    {RECRUIT_UNIT_VARIATIONS 5 "Walking Corpse" troll,saurian,drake}

    # Water spirits in NW tunnels
    [side]
        side=6
        team_name=gaia
        user_team_name= _ "team_name^Cave Creatures"
        {RAGGED_FLAG}

        no_leader=yes
        hidden=yes

        recruit=Water Tidal,Water Spirit,Walking Corpse,Mudcrawler,Water Serpent

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value                 0.00}
            {AI_SIMPLE_ALWAYS_ASPECT grouping                      defensive}
            {AI_SIMPLE_ALWAYS_ASPECT aggression                    1.00}
            {AI_SIMPLE_ALWAYS_ASPECT caution                       0.00}
            {AI_SIMPLE_ALWAYS_ASPECT recruitment_ignore_bad_combat yes}
        [/ai]

        {TSOL_SENTRY (Water Spirit) 17 31}
        {TSOL_SENTRY (Water Spirit) 16 26}
        {TSOL_SENTRY (Water Spirit) 13 30}
        {TSOL_SENTRY (Water Spirit) 18 28}
        {TSOL_SENTRY (Water Spirit) 21 22}

        {TSOL_SENTRY (Water Serpent) 10 27}
        {TSOL_SENTRY (Water Serpent)  8 31}
        {TSOL_SENTRY (Water Serpent)  3 30}

        {TSOL_SENTRY {TSOL_DZOMBIE} 19 25} {VARIATION swimmer}
        {TSOL_SENTRY {TSOL_DZOMBIE} 19 21} {VARIATION swimmer}
        {TSOL_SENTRY {TSOL_DZOMBIE} 20 31} {VARIATION swimmer}
        {TSOL_SENTRY {TSOL_DZOMBIE} 22 20} {VARIATION swimmer}

        {TSOL_SENTRY (Giant Mudcrawler) 15 21}
        {TSOL_SENTRY (Giant Mudcrawler)  9 24}
        {TSOL_SENTRY (Giant Mudcrawler) 13 25}
    [/side]

    {RECRUIT_UNIT_VARIATIONS 6 "Walking Corpse" swimmer,swimmer,bat}

    # Miscellaneous creatures
    [side]
        side=7
        team_name=gaia
        user_team_name= _ "team_name^Cave Creatures"
        {RAGGED_FLAG}

        no_leader=yes
        hidden=yes

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value                 0.00}
            {AI_SIMPLE_ALWAYS_ASPECT grouping                      no}
            {AI_SIMPLE_ALWAYS_ASPECT aggression                    1.00}
            {AI_SIMPLE_ALWAYS_ASPECT caution                       0.00}
        [/ai]

        {TSOL_SENTRY (Giant Spider) 24  6} {FACING se}
#ifndef EASY
        {TSOL_SENTRY (Giant Spider) 16 12} {FACING sw}
#endif

        {TSOL_SENTRY (Giant Ant) 10 21}
        {TSOL_SENTRY (Giant Ant) 11 22}
        {TSOL_SENTRY (Giant Ant) 10 22}

        {TSOL_SENTRY (Giant Ant) 15 20}

        {TSOL_SENTRY (Giant Ant) 27 20}
        {TSOL_SENTRY (Giant Ant) 28 23}
        {TSOL_SENTRY (Giant Ant) 21 33}
        {TSOL_SENTRY (Giant Ant) 20 34}

        {TSOL_SENTRY (Fungoid) 24 13}
        {TSOL_SENTRY (Fungoid) 37  6}
        {TSOL_SENTRY (Fungoid) 35  8}
        {TSOL_SENTRY (Fungoid) 42  9}
        {TSOL_SENTRY (Fungoid) 52 34}
        {TSOL_SENTRY (Fungoid) 57 34}
        {TSOL_SENTRY (Fungoid) 33 41}
        {TSOL_SENTRY (Fungoid) 28 46}
        {TSOL_SENTRY (Fungoid) 24 44}
        {TSOL_SENTRY (Fungoid) 11 48}
        {TSOL_SENTRY (Fungoid) 16 47}
        {TSOL_SENTRY (Fungoid) 14 38}
        {TSOL_SENTRY (Fungoid) 43 25}
        {TSOL_SENTRY (Fungoid) 43 31}
        {TSOL_SENTRY (Fungoid) 38 35}
        {TSOL_SENTRY (Fungoid) 26 33}
        {TSOL_SENTRY (Fungoid) 26 31}
        {TSOL_SENTRY (Fungoid) 22 25}

        {TSOL_SENTRY (Eyestalk) 21 41}
        {TSOL_SENTRY (Eyestalk) 13 36}
        {TSOL_SENTRY (Eyestalk) 18 13}

        {TSOL_SENTRY (Leech) 13  6}
        {TSOL_SENTRY (Leech) 37 12}
        {TSOL_SENTRY (Leech) 52 31}
        {TSOL_SENTRY (Leech) 32 43}
        {TSOL_SENTRY (Leech) 12 58}
        {TSOL_SENTRY (Leech)  2 26}
        {TSOL_SENTRY (Leech)  1 25}

        {TSOL_SENTRY (Giant Leech) 12  3}
        {TSOL_SENTRY (Giant Leech)  7 14}
    [/side]

    {CAVE_NOISE_SOUND_SOURCE}

    {CAVE_WATER_SOUND_SOURCE 29 29}

    {CAVE_WATER_SOUND_SOURCE 11 30}

    {CAVE_WATER_SOUND_SOURCE 24 19}

    {CAVE_WATER_SOUND_SOURCE 11 16}

    {CAVE_WATER_SOUND_SOURCE 32 12}

    #
    # FIXME: Yes, the names are hardcoded because sound sources haven't
    #        received enough love from the developers and there isn't a lot
    #        that can be done with them in Lua/WML.
    #
#define TSOL_DISABLE_WATER_SOUND_SOURCES
    {REMOVE_SOUND_SOURCE __ss_cave_water_29_29}

    {REMOVE_SOUND_SOURCE __ss_cave_water_11_30}

    {REMOVE_SOUND_SOURCE __ss_cave_water_24_19}

    {REMOVE_SOUND_SOURCE __ss_cave_water_11_16}

    {REMOVE_SOUND_SOURCE __ss_cave_water_32_12}
#enddef

    {STARTING_VILLAGES 1 6}
    {STARTING_VILLAGES 2 8}

#define TSOL_INITIAL_OBJECTIVES
    [fire_event]
        name=initial objectives
    [/fire_event]
#enddef

#define TSOL_DECLARE_SEAL_GLYPH _GX _GY _PX _PY
    [literal]
        x={_GX}
        y={_GY}
        pillar_x={_PX}
        pillar_y={_PY}
    [/literal]
#enddef

    [event]
        name=prestart

        {VARIABLE active_seal_glyphs     6}
        {VARIABLE found_central_chamber  no}
        {VARIABLE glyph_scrying_progress -1}

        [set_variables]
            name=seal_glyphs
            mode=replace

            {TSOL_DECLARE_SEAL_GLYPH   51 16   40 26}
            {TSOL_DECLARE_SEAL_GLYPH   56 51   40 31}
            {TSOL_DECLARE_SEAL_GLYPH   28 43   35 34}
            {TSOL_DECLARE_SEAL_GLYPH   14 49   30 31}
            {TSOL_DECLARE_SEAL_GLYPH    6 29   30 26}
            {TSOL_DECLARE_SEAL_GLYPH   23  5   35 24}
        [/set_variables]

        {FOREACH seal_glyphs k}
            {PLACE_IMAGE "scenery/rune$($k + 1).png" $seal_glyphs[$k].x $seal_glyphs[$k].y}

            [event]
                name=moveto
                delayed_variable_substitution=no
                [filter]
                    side=1
                    x,y=$seal_glyphs[$k].x,$seal_glyphs[$k].y
                [/filter]

                [fire_event]
                    name=trigger glyph activated
                    [primary_unit]
                        x,y=$|x1,$|y1 # Delay substitution.
                    [/primary_unit]
                [/fire_event]
            [/event]
        {NEXT k}

        {PLAYER_RECRUITMENT_SETUP_FOR_SCENARIO 10}

        #
        # Recall heroes
        #

        # wmllint: recognize Anlindë
        {RECALL_ANLINDE_AT    52  5}
        # wmllint: recognize Mal Keshar
        {RECALL_MAL_KESHAR_AT 54  6}
        # wmllint: recognize Althurin
        {RECALL_ALTHURIN_AT   52  6}
        # wmllint: recognize Igor
        {RECALL_IGOR}

        [role]
            side=1
            role=scout
            type=Elvish Marksman,Elvish Ranger,Elvish Outrider,Elvish Rider,Elvish Captain,Elvish Hero,Elvish Fighter,Elvish Scout,Elvish Archer,Civilian
            [not]
                id=Galas
            [/not]
        [/role]

        [role]
            side=1
            role=magic user
            type=Elvish Shyde,Elvish Sylph,Elvish Enchantress,Elvish Druid,Elvish Sorceress,Elvish Shaman
        [/role]

        [recall]
            x,y=53,7
            role=magic user
        [/recall]

        [recall]
            role=scout
        [/recall]

        {TSOL_INITIAL_OBJECTIVES}
    [/event]

    #
    # Objectives used before and after killing Mena before the glyph
    # search begins.
    #
    [event]
        name=initial objectives
        first_time_only=no

        {OBJECTIVES (
            victory_string= _ "Current Objectives:"
            {OBJECTIVE_VICTORY ( _ "Explore the caves")}

            {OBJECTIVE_DEFEAT ( _ "Death of Galas")}
            {OBJECTIVE_DEFEAT ( _ "Death of Anlindë")}
            {OBJECTIVE_DEFEAT ( _ "Death of Mal Keshar")}
            {OBJECTIVE_DEFEAT ( _ "Death of Althurin")}

            {TURNS_RUN_OUT}

            {OBJECTIVE_CARRYOVER}
        )}
    [/event]

    [event]
        name=update objectives
        first_time_only=no

        [filter_condition]
            [have_unit]
                id=Mena
            [/have_unit]
        [/filter_condition]

        {OBJECTIVES (
            victory_string= _ "Current Objectives:"
            {OBJECTIVE_VICTORY ( _ "Defeat the enemy leader")}

            {OBJECTIVE_DEFEAT ( _ "Death of Galas")}
            {OBJECTIVE_DEFEAT ( _ "Death of Anlindë")}
            {OBJECTIVE_DEFEAT ( _ "Death of Mal Keshar")}
            {OBJECTIVE_DEFEAT ( _ "Death of Althurin")}

            {TURNS_RUN_OUT}

            {OBJECTIVE_CARRYOVER}
        )}
    [/event]

    [event]
        name=update objectives
        first_time_only=no

        [filter_condition]
            [not]
                [have_unit]
                    id=Mena
                [/have_unit]
            [/not]
        [/filter_condition]

        # We need to be able to update this every time so the current value of
        # $active_seal_glyphs is processed.
        {OBJECTIVES (
            victory_string= _ "Current Objectives:"
            {OBJECTIVE_VICTORY
            (_"Find and activate all six trigger runes"+" <small>"+_"($active_seal_glyphs runes remaining)"+"</small>")}

            {OBJECTIVE_DEFEAT ( _ "Death of Galas")}
            {OBJECTIVE_DEFEAT ( _ "Death of Anlindë")}
            {OBJECTIVE_DEFEAT ( _ "Death of Mal Keshar")}
            {OBJECTIVE_DEFEAT ( _ "Death of Althurin")}

            {TURNS_RUN_OUT}

            {OBJECTIVE_CARRYOVER}

            {OBJECTIVE_NOTE ( _ "Allow Mal Keshar to rest for three consecutive turns and he will reveal the location of the trigger runes")}
            # Don't display the note before the event where Mal Keshar suggests
            # doing this, or after he has already located the glyphs.
            {OBJECTIVE_NOTE_SHOW_IF ({VARIABLE_NUMERICAL_NOT_EQUALS glyph_scrying_progress -1})}
        )}

        [show_objectives][/show_objectives]
    [/event]

#define TSOL_UPDATE_OBJECTIVES
    [fire_event]
        name=update objectives
    [/fire_event]
#enddef

    [event]
        name=start

        [message]
            speaker=Galas
            message= _ "I’m fairly certain we have been to this intersection countless times before. How much deeper could the last home of our heroes be?"
        [/message]

        [message]
            role=scout
            message= _ "I wouldn’t know for sure, sir, but at this rate I think we may soon reach the very bottom of the earth and find that there’s nothing below but a blazing hell—"
        [/message]

        [message]
            speaker=Mal Keshar
            sound=rumble.ogg
            message= _ "<b>SILENCE!</b>"
        [/message]

        [delay]
            time=750
        [/delay]

        [message]
            role=magic user
            message= _ "It is... an enormous power. It fills the entire place!"
        [/message]

        [message]
            speaker=Mal Keshar
            message= _ "Yes, indeed, I recognize this presence. We must be finally there."
        [/message]

        [message]
            speaker=Galas
            message= _ "You magic-skilled people can perceive things which are beyond me."
        [/message]

        [message]
            speaker=Althurin
            message= _ "Indeed, lad. Magic skill lets ye ken things whose existence is normally ignored by common folk. Every rock in these caves, even the air... everything is imbued with an ancient magic not known to any living dwarf in this age. ’Tis a dangerous place to senselessly wander without nature’s permission."
        [/message]

        {QUAKE cave-in.ogg}

        [message]
            speaker=Galas
            message= _ "Fair enough. I hope we find them soon, before we run out of food and torches..."
        [/message]

        [message]
            speaker=Anlindë
            message= _ "And before the Chaos army reaches Herthgar, I would add. While the might of the dwarves and their many inventions may normally provide an insurmountable obstacle to invaders from the surface, I have this disquieting feeling that the enemy that approaches is much unlike the other commanders we have faced thus far."
        [/message]

        {QUAKE rumble.ogg}

        [message]
            role=scout
            message= _ "My lady, sirs, less chatter and more exploring, before the walls cave in on us!"
        [/message]
    [/event]

    #
    # Random earthquake effect when units move.
    #

    [event]
        name=moveto
        first_time_only=no

        [lua]
            code= <<
                local rumble_seed = unsynced_random("1..100")

                if rumble_seed % 11 == 0 then -- 9.09% chance
                    wesnoth.wml_actions.sound({ name = "cave-in.ogg,cave-in.ogg,rumble.ogg" })
                end

                if rumble_seed % 13 == 0 then -- 7.69% chance
                    wesnoth.wml_actions.quake({ sound = "cave-in.ogg" })
                end

                if rumble_seed % 29 == 0 then -- 3.44% chance
                    wesnoth.wml_actions.quake({ sound = "rumble.ogg" })
                end
            >>
        [/lua]

        [allow_undo][/allow_undo]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=1-44
            y=1-999
        [/filter]

        {FACE_UNIT id=Mena  id=Galas}
        {FACE_UNIT id=Galas id=Mena}

        {CLEAR_CAVE_SHROUD (
            [filter]
                id=Mena
            [/filter]
            radius=6
        )}

        [redraw]
            side=1
        [/redraw]

        [message]
            speaker=Mena
            # po: "She is dead"
            message= _ "The elves! How could they get past the commander? This can only mean she is... Damn it all!"
        [/message]

        [message]
            speaker=Galas
            message= _ "You too will perish at our hands if you insist on hindering us, demon."
        [/message]

        [message]
            speaker=Mena
            message= _ "So be it! I would rather die than surrender to you, Irdyan scum!"
        [/message]

        [modify_side]
            side=2
            recruit=Demon,Chaos Invoker,Automaton,Demon Zephyr
            {GOLD 120 135 150}
        [/modify_side]

        {MOBILIZE_GUARDIANS side=2}

        [scroll_to_unit]
            x,y=$x1,$y1
        [/scroll_to_unit]

        {TSOL_UPDATE_OBJECTIVES}
    [/event]

    [event]
        name=attack
        [filter]
            type=Goliath,Iron Golem
        [/filter]
        [filter_second]
            side=1
            [and]
                race=elf
                [or]
                    race=undead
                    [not]
                        type=Walking Corpse,Soulless
                    [/not]
                [/or]
            [/and]
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Surely I could use some help here!"
        [/message]

        [message]
            speaker=unit
            message= _ "Die, vermin!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Mena
        [/filter]

        [message]
            speaker=unit
            message= _ "Oh, Uria... I have... failed... All our efforts... fruitless..."
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=Mena
        [/filter]

        [if]
            {VARIABLE_BOOLEAN_EQUALS found_central_chamber yes}
            [then]
                [fire_event]
                    name=enter central chamber
                [/fire_event]

                [scroll_to]
                    x,y=$x1,$y1
                [/scroll_to]
            [/then]
            [else]
                {TSOL_INITIAL_OBJECTIVES}
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                x,y=35,29
                radius=8
            [/filter_location]
        [/filter]

        {VARIABLE found_central_chamber yes}

        [if]
            [not]
                [have_unit]
                    id=Mena
                [/have_unit]
            [/not]
            [then]
                [fire_event]
                    name=enter central chamber
                [/fire_event]

                [scroll_to]
                    x,y=$x1,$y1
                [/scroll_to]
            [/then]
            [else]
                [allow_undo][/allow_undo]
            [/else]
        [/if]
    [/event]

#define TSOL_SET_UP_GUARD_SIDE _SIDE _UNIT_WML _SIDE_WML
    [store_starting_location]
        side={_SIDE}
    [/store_starting_location]

    [unit]
        side={_SIDE}
        x,y=$location.x,$location.y
        {_UNIT_WML}
    [/unit]

    [capture_village]
        side={_SIDE}
        x,y=$location.x,$location.y
        radius=5
    [/capture_village]

    [modify_side]
        side={_SIDE}
        {_SIDE_WML}
    [/modify_side]

    {CLEAR_VARIABLE location}
#enddef

    [event]
        name=reveal central chamber
        first_time_only=no

        [remove_shroud]
            side=1
            x,y=35,29
            radius=8
        [/remove_shroud]

        [redraw]
            side=1
        [/redraw]
    [/event]

    [event]
        name=enter central chamber

        {LOCK_VIEW}

        {REPLACE_SCENARIO_MUSIC silence.ogg}

        {QUAKE rumble.ogg}

        [fire_event]
            name=activate glyph chamber guards
        [/fire_event]

        [fire_event]
            name=reveal central chamber
        [/fire_event]

        [scroll_to]
            x,y=35,29
        [/scroll_to]

        [delay]
            time=1000
        [/delay]

        [message]
            speaker=Galas
            message= _ "The structure at the center of this chamber seems very conspicuous."
        [/message]

        [delay]
            time=750
        [/delay]

        [message]
            speaker=Galas
            message= _ "Anlindë?"
        [/message]

        [message]
            speaker=Anlindë
            message= _ "We found it, Galas! This is the final resting place of the Lady of Light and the Master of Darkness! That strong magic comes from within the structure. We need to find a way to enter."
        [/message]

        [scroll_to]
            x,y=35,33
        [/scroll_to]

        {HIGHLIGHT_GOAL x,y=35,33}

        {REPLACE_SCENARIO_MUSIC snowfall.ogg}
        {APPEND_MUSIC           wanderer.ogg}
        {APPEND_MUSIC           nunc_dimittis.ogg}
        {APPEND_MUSIC           into_the_shadows.ogg}

        [message]
            speaker=Mal Keshar
            message= _ "Hm, it’s evident they did not want anybody waking them from their slumber. The entrance seems to be completely blocked, and the six pillars around the structure appear to be part of some kind of magic seal."
        [/message]

        [message]
            speaker=Althurin
            message= _ "They carved glyphs in them! Ancient dwarvish runes! This musta’ been the work of our kin from ages past. I ha’ heard of this kind of seal before... There may be trigger runes around the area, mayhap designed to be activated by specific people."
        [/message]

        [message]
            speaker=Anlindë
            message= _ "Yes. Hm, I imagine that the Lady of Light would mandate the glyphs to react only to the presence of elvenkind and their allies, so... that may explain why the demons were unable to do anything here. That said, if our arrival had been delayed long enough, they might have eventually figured out a way to violate the seal’s magic."
        [/message]

        [message]
            speaker=Galas
            message= _ "All we have to do, then, is to search for the triggers in these caves?"
        [/message]

        [message]
            speaker=Althurin
            message= _ "Aye, aye... Well, there’s no guarantee that they may ha’ carved them in accessible locations close to this chamber, but ’tis a good starting point as any."
        [/message]

        [message]
            speaker=Galas
            message= _ "Sure, let’s do it!"
        [/message]

        [message]
            speaker=Mal Keshar
            message= _ "Careful, elf — the earth itself does not seem pleased with our intrusion in its eternal domain. As far as it is concerned, we are unwelcome parasites not unlike the demons we just vanquished."
        [/message]

        {UNLOCK_VIEW}

        {TSOL_UPDATE_OBJECTIVES}

        #
        # Allow Mal Keshar to help with locating the runes.
        #

        [event]
            delayed_variable_substitution=no
            name="turn $($turn_number + 2)"

            [fire_event]
                name=begin glyph scrying
            [/fire_event]
        [/event]
    [/event]

    [event]
        name=activate glyph chamber guards

        {TSOL_SET_UP_GUARD_SIDE 3 (
            canrecruit=yes
            type=Chocobone
        ) {GOLD 50 75 100} }

        {TSOL_SET_UP_GUARD_SIDE 4 (
            canrecruit=yes
            type=Fire Spirit
        ) {GOLD 50 75 100} }

        {TSOL_SET_UP_GUARD_SIDE 5 (
            canrecruit=yes
            type=Rock Golem
            # This special golem cannot move around, but has great defense ratios
            [modifications]
                [object]
                    silent=yes
                    [effect]
                        apply_to=movement
                        set=1
                    [/effect]
                    [effect]
                        apply_to=movement_costs
                        replace=true
                        [movement_costs]
                            deep_water={UNREACHABLE}
                            shallow_water={UNREACHABLE}
                            reef={UNREACHABLE}
                            swamp_water={UNREACHABLE}
                            flat={UNREACHABLE}
                            sand={UNREACHABLE}
                            forest={UNREACHABLE}
                            hills={UNREACHABLE}
                            mountains={UNREACHABLE}
                            village={UNREACHABLE}
                            castle={UNREACHABLE}
                            cave={UNREACHABLE}
                            frozen={UNREACHABLE}
                            unwalkable={UNREACHABLE}
                            impassable={UNREACHABLE}
                            fungus={UNREACHABLE}
                        [/movement_costs]
                    [/effect]
                    [effect]
                        apply_to=defense
                        replace=true
                        [defense]
                            cave=30
                            impassable=20
                            hills=30
                            mountains=20
                            fungus=30
                        [/defense]
                    [/effect]
                [/object]
            [/modifications]
        ) {GOLD 50 75 100} }

        {TSOL_SET_UP_GUARD_SIDE 6 (
            canrecruit=yes
            type=Cuttle Fish
        ) {GOLD 50 75 90} }
    [/event]

    [event]
        name=begin glyph scrying

        [message]
            speaker=Mal Keshar
            message= _ "Perhaps if I was allowed to concentrate for a while, I would be able to pinpoint the precise location of the glyphs using magic."
        [/message]

        [message]
            speaker=Galas
            message= _ "Really? That would be a great help!"
        [/message]

        [message]
            speaker=Mal Keshar
            message= _ "I am not completely sure it is possible, but I can try."
        [/message]

        {VARIABLE glyph_scrying_progress 0}

        {TSOL_UPDATE_OBJECTIVES}

        [event]
            delayed_variable_substitution=no
            id=glyph_scrying_progress_incrementor_eh
            name=new turn
            first_time_only=no
            [filter_condition]
                #
                # This event is generated on a new turn event, and we don't
                # want it to run on the same turn it is generated.
                #
                {VARIABLE_NUMERICAL_GREATER_THAN turn_number "$turn_number"}
            [/filter_condition]

            [store_unit]
                [filter]
                    id=Mal Keshar
                [/filter]
                kill=no
                variable=malin_store
            [/store_unit]

            [if]
                {VARIABLE_BOOLEAN_EQUALS malin_store.resting yes}
                [then]
                    {VARIABLE_INC glyph_scrying_progress}

                    [floating_text]
                        [filter]
                            id=Mal Keshar
                        [/filter]
                        text= _ "Concentrating"
                    [/floating_text]
                [/then]
                [else]
                    {VARIABLE glyph_scrying_progress 0}
                [/else]
            [/if]

            {CLEAR_VARIABLE malin_store}
        [/event]

        [event]
            id=glyph_scrying_finish_eh
            name=new turn
            first_time_only=no
            [filter_condition]
                {VARIABLE_NUMERICAL_GREATER_THAN glyph_scrying_progress 3}
            [/filter_condition]

            [fire_event]
                name=glyph scrying complete
            [/fire_event]
        [/event]
    [/event]

    [event]
        name=glyph scrying complete

        [event]
            id=glyph_scrying_progress_incrementor_eh
            remove=yes
        [/event]

        [event]
            id=glyph_scrying_finish_eh
            remove=yes
        [/event]

        # Flag for the objectives screen.
        {VARIABLE glyph_scrying_progress -1}

        [message]
            speaker=Mal Keshar
            message= _ "Yes, I found them!"
        [/message]

        {FOREACH seal_glyphs k}
            [remove_shroud]
                side=1
                x,y=$seal_glyphs[$k].x,$seal_glyphs[$k].y
                radius=3
            [/remove_shroud]

            [redraw]
                side=1
            [/redraw]

            [scroll_to]
                x,y=$seal_glyphs[$k].x,$seal_glyphs[$k].y
            [/scroll_to]

            {HIGHLIGHT_GOAL x,y=$seal_glyphs[$k].x,$seal_glyphs[$k].y}
        {NEXT k}

        [message]
            speaker=Anlindë
            message= _ "Thanks, Mal Keshar. This will certainly make our mission much easier. Now we only need to clear the path leading to each glyph."
        [/message]

        {TSOL_UPDATE_OBJECTIVES}
    [/event]

    #
    # Unique glyph handler, expects a primary unit.
    #
    # The glyph locations and the proxy moveto EH that fires this event are
    # defined by the prestart EH.
    #
    [event]
        name=trigger glyph activated
        first_time_only=no

        [store_items]
            x,y=$x1,$y1
        [/store_items]

        {BUG_ON {VARIABLE_NUMERICAL_GREATER_THAN items.length 1} ()}

        [remove_item]
            x,y=$x1,$y1
        [/remove_item]

        [lua]
            code=<<
                local var = "items[0].image"
                local v = tostring(wesnoth.get_variable(var))

                v = v:gsub("scenery/rune(%d)%.png", "scenery/rune%1-glow.png")

                wesnoth.set_variable(var, v)
            >>
        [/lua]

        [terrain]
            x,y=$x1,$y1
            layer=overlay
            terrain=^Ii
        [/terrain]

        [insert_tag]
            name=item
            variable=items[0]
        [/insert_tag]

        {CLEAR_VARIABLE items}

        {VARIABLE_DEC active_seal_glyphs}

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Rune activated."
        [/message]

        [if]
            {VARIABLE_NUMERICAL_GREATER_THAN active_seal_glyphs 0}
            [then]
                #
                # Display the updated remaining glyphs counter.
                #
                {TSOL_UPDATE_OBJECTIVES}
            [/then]
            [else]
                #
                # End the scenario.
                #

                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    message= _ "All glyphs have been activated. The earth shakes!"
                [/message]

                {ENDLEVEL_VICTORY no}
            [/else]
        [/if]
    [/event]

    #
    # The glyph at 51,16 has a secondary event
    #
    [event]
        name=moveto
        [filter]
            side=1
            x,y=51,16
        [/filter]

        [terrain]
            x=   50,   51
            y=11-12,13-15
            terrain=Rb
        [/terrain]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "A wall moves."
        [/message]

        [redraw]
            side=1
        [/redraw]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                [filter_adjacent_location]
                    terrain=*^Z/,*^Z\
                [/filter_adjacent_location]
            [/filter_location]
        [/filter]

        [if]
            [have_unit]
                x,y=$x1,$y1
                [not]
                    race=bats,undead
                    [not]
                        type=Lich,Ancient Lich,Ghost,Wraith,Spectre,Shadow,Nightgaunt
                    [/not]
                [/not]
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    message= _ "Hmm... This gate seems magical in nature. It glows blue in a pulsating and mesmerizing fashion, and my hands are unable to reach the metal bars, as though they were enveloped by an invisible shield."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Mal Keshar
                    scroll=no
                    message= _ "Hmm... My minions inform me that the gate seems magical in nature. Their hands are unable to reach the metal bars, as if they were protected by some kind of shield."
                [/message]
            [/else]
        [/if]

        [message]
            speaker=Galas
            scroll=no
            message= _ "There must be a way to open the gate, somewhere."
        [/message]
    [/event]

#define TSOL_AREA_DESCRIPTION_UNIT
    x,y=$x1,$y1
    [not]
        race=bats,undead
        [not]
            type=Lich,Ancient Lich,Ghost,Wraith,Spectre,Shadow,Nightgaunt
        [/not]
    [/not]
    [or]
        id=Mal Keshar
    [/or]
#enddef

    #
    # Water zone narration.
    #
    [event]
        name=moveto
        [filter]
            x= 1-25
            y=18-34
            side=1
        [/filter]

        {CLEAR_CAVE_SHROUD (
            x=16-30
            y=33-19
            radius=1
            terrain=W*
        )}

        [redraw][/redraw]

        [message]
            {TSOL_AREA_DESCRIPTION_UNIT}
            scroll=no
            message= _ "Wow. It’s a very large underground pool. There are some shallow parts where the ground below sticks out interspersed with deeper bits we cannot cross. The whole area seems well-guarded by aquatic creatures and spirits. Getting to the island behind the ruined building will not as easy as I would prefer."
        [/message]
    [/event]

    #
    # Lava zone narration.
    #
    [event]
        name=moveto
        [filter]
            side=1
            x=44-68
            y=36-60
        [/filter]

        {CLEAR_CAVE_SHROUD (
            x,y=48,39
            radius=4
        )}

        [redraw][/redraw]

        [message]
            {TSOL_AREA_DESCRIPTION_UNIT}
            scroll=no
            message= _ "The air here is unbearably dense and hot due to the pools and outflows of lava everywhere. Of course, the fire spirits below don’t mind the temperature at all — they frolic in the lava and seem completely unharmed by it. I would advise against allowing our undead warriors to explore the area unassisted."
        [/message]
    [/event]

    #
    # Potion of drain.
    #
    {PICK_UP (items/potion-poison.png) 63 19 (
        [not]
            race=bats,undead
        [/not]
    )
    ( _ "This is a strange ornate emerald bottle containing a foul-smelling potion. The scroll next to it, though highly deteriorated due to its age, still has enough legible words on it so I can tell that it explains the nature of the potion. Apparently, it makes the drinker much weaker than usual, but it also allows them to drain the life force of every creature they come into contact with to replenish their own.

The effects are said to be permanent, which only makes me more unsure about whether it is really worth the trade-off.")
    ( _ "This potion may only be used by living units, not including bats.")
    (
        [sound]
            name=poison.ogg
        [/sound]

        [object]
            id=e1s10_drainer_potion
            name= _ "Potion of Drain"
            image=icons/potion-green-4.png
            duration=forever
            description= _ "This potion grants the <i>drains</i> special to the unit’s melee attacks, reduces its maximum hitpoints by 5%, and increases its resistance to arcane damage by 10%."
            [filter]
                x,y=$x1,$y1
            [/filter]
            [effect]
                apply_to=attack
                range=melee
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_DRAIN}
                [/set_specials]
            [/effect]
            [effect]
                apply_to=hitpoints
                increase_total=-5%
            [/effect]
            [effect]
                apply_to=resistance
                replace=no
                [resistance]
                    arcane=-10
                [/resistance]
            [/effect]
        [/object]
    )}

    #
    # Berserker potion.
    #
    {PICK_UP (items/potion-red.png) 36 39 (
        [not]
            type=Walking Corpse,Soulless
        [/not]
        [not]
            type=Ghost,Wraith,Shadow,Spectre,Nightgaunt
        [/not]
        [not]
            type=Elvish Shaman,Elvish Druid,Elvish Shyde,Elvish Sorceress,Elvish Enchantress,Elvish Sylph
        [/not]
        [not]
            id=Anlindë,Mal Keshar
        [/not]
        [not]
            race=bats
        [/not]
    )
    ( _ "Such a pretty potion flask! As I open and smell the red liquid inside, I immediately feel energized and ready to take down any incoming threat. It appears to be a berserker potion, said to make the user stronger and fiercer in battle. Using these is often reserved for last-resort situations because of the potential side effects, which include utter recklessness and even psychosis!

Nevertheless, it might prove useful in our war against the Chaos Empire, and the flask contains enough potion for a dozen fights, if not more.")
    ( _ "This potion may only be used by a true warrior with an axe or sword in hand.")
    (
        [sound]
            name=potion.ogg
        [/sound]

        # wmllint: local spelling &#8226;

        [object]
            id=e1s10_berserker_potion
            name= _ "Berserker Potion"
            image=icons/potion-red-1.png
            duration=forever
            description= _ "This potion grants the <i>berserk</i> special to the unit’s melee attacks, which also see their damage increased by one. As an advantageous side effect, the unit’s maximum hitpoints increase by 10%, and it also becomes more resistant to certain forms of damage:

 &#8226; Blade: +10% resistance
 &#8226; Fire: +20% resistance
 &#8226; Impact: +30% resistance"
            [filter]
                x,y=$x1,$y1
            [/filter]
            [effect]
                apply_to=attack
                range=melee
                increase_damage=1
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_BERSERK}
                [/set_specials]
            [/effect]
            [effect]
                apply_to=hitpoints
                increase_total=10%
            [/effect]
            [effect]
                apply_to=resistance
                replace=no
                [resistance]
                    impact=-30
                    blade=-10
                    fire=-20
                [/resistance]
            [/effect]
        [/object]
    )}

    #
    # Touchplate at 39,53 opening a glyph room.
    #
    {ITEM_TOUCHPLATE 39 53}

    [event]
        name=moveto
        [filter]
            side=1
            x,y=39,53
        [/filter]

        [remove_item]
            x,y=$x1,$y1
        [/remove_item]

        [terrain]
            x,y=28,44
            terrain=Ur
        [/terrain]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_"Touchplate triggered. A magical gate opens."
        [/message]

        {CLEAR_CAVE_SHROUD x,y,radius=28,44,1}

        [redraw]
            side=1
        [/redraw]

        [scroll_to]
            x,y=28,44
        [/scroll_to]

        {HIGHLIGHT_GOAL x,y=28,44}

        [scroll_to]
            x,y=$x1,$y1
        [/scroll_to]
    [/event]

    [event]
        name=enter hex
        [filter]
            side=1
            x,y="33-34","47"
            [not]
                type=Ghost,Wraith,Spectre,Shadow,Nightgaunt
            [/not]
            [not]
                race=bats
            [/not]
        [/filter]

        [allow_undo][/allow_undo]

        [if]
            [have_unit]
                x,y=$x1,$y1
                [not]
                    race=undead
                    [not]
                        type=Lich,Ancient Lich
                    [/not]
                [/not]
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    message= _ "This bridge seems extremely unsafe..."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Mal Keshar
                    scroll=no
                    message= _ "That bridge seems extremely unsafe."
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=victory

        {LOCK_VIEW}

        #
        # Remove sound sources we no longer need to free up mixer channels.
        #
        {TSOL_DISABLE_WATER_SOUND_SOURCES}

        {REPLACE_SCENARIO_MUSIC silence.ogg}

        #
        # Reveal the central chamber in case we are in debug mode.
        #
        [fire_event]
            name=reveal central chamber
        [/fire_event]

        {FOREACH seal_glyphs k}
            [scroll_to]
                x,y=$seal_glyphs[$k].pillar_x,$seal_glyphs[$k].pillar_y
                {WARP}
            [/scroll_to]

            [terrain]
                terrain=Qxu
                #terrain=Qxu^Ii
                x,y=$seal_glyphs[$k].pillar_x,$seal_glyphs[$k].pillar_y
            [/terrain]

            [redraw]
                side=1
            [/redraw]

            {QUAKE thunderstick.ogg}

            [delay]
                time=150
            [/delay]
        {NEXT k}

        [scroll_to]
            x,y=35,32
            {WARP}
        [/scroll_to]

        [delay]
            # Long delay, gives sounds a chance to finish playing.
            time=750
        [/delay]

        [hide_unit][/hide_unit]

        {WHITE_SCREEN}

        [delay]
            time=250
        [/delay]

        [terrain]
            terrain=Rb
            layer=base
            x,y=35,31-32
        [/terrain]

        # Lit up the entrance.
        [terrain]
            terrain=Xol
            x=33-34,36-37
            y=   31,   31
        [/terrain]

        [terrain]
            terrain=^Bz
            layer=overlay
            x=34,36
            y=32,32
        [/terrain]

        [redraw]
            side=1
        [/redraw]

        {RESET_SCREEN}

        [unhide_unit][/unhide_unit]

        {QUAKE dragonstick.ogg}

        [delay]
            time=750
        [/delay]

        #
        # Just to keep the cutscene zone clear.
        #

        {RESET_AND_SEND_TO_RECALL_LIST (
            side=1
            [not]
                id=Galas,Mal Keshar,Anlindë,Althurin
            [/not]
            [not]
                x,y=recall,recall
            [/not]
        )}

        [teleport]
            [filter]
                id=Galas
            [/filter]
            x,y=35,33
        [/teleport]

        [teleport]
            [filter]
                id=Mal Keshar
            [/filter]
            x,y=34,33
        [/teleport]

        [teleport]
            [filter]
                id=Anlindë
            [/filter]
            x,y=36,33
        [/teleport]

        [teleport]
            [filter]
                id=Althurin
            [/filter]
            x,y=34,34
        [/teleport]

        [unit]
            {CHARACTER_STATS_UNARYE}
            side=1
            x,y=36,34
            placement=map_passable
        [/unit]

        {FACE_LOCATION (id=Galas,Anlindë,Mal Keshar,Althurin,Unarye) x,y=35,32}

        {REPLACE_SCENARIO_MUSIC underground.ogg}

        [delay]
            time=750
        [/delay]

        [message]
            speaker=Galas
            message= _ "At long last! Let us go, now."
        [/message]

        [message]
            speaker=Mal Keshar
            message= _ "I have been waiting for this for too long."
        [/message]

        [message]
            speaker=Anlindë
            message= _ "Wait, Galas, before continuing... only the two of us should enter."
        [/message]

        [message]
            speaker=Galas
            message= _ "... Why?"
        [/message]

        [message]
            speaker=Anlindë
            message= _ "The regent lord of the elves is really the only appropriate person to meet the Lady of Light and the Master of Darkness after such a long time, but since you don’t have any magic abilities, my presence may be required to wake our heroes from their eternal sleep. It is not proper that anybody else should be present around the greatest sages in the history of elvenkind on this singular occasion."
        [/message]

        [delay]
            time=750
        [/delay]

        [message]
            speaker=Galas
            message= _ "I must say, I never expected such words from you, Anlindë. After so long, we are finally here, but not only thanks to you — we owe a great debt to Lady Unarye and Mal Keshar as well, and this is why I must ask them to accompany us as well."
        [/message]

        [message]
            speaker=Unarye
            scroll=no
            message= _ "Me— meeting the Lady of Light in person? I would be greatly honored, my lord!"
        [/message]

        [message]
            speaker=Mal Keshar
            message= _ "Ah, so would I. Galas, you really are an example to follow for the other elves!"
        [/message]

        [message]
            speaker=Anlindë
            message= _ "But I—"
        [/message]

        [message]
            speaker=Galas
            message= _ "You will allow them to come with us. This is an order, Anlindë."
        [/message]

        [delay]
            time=750
        [/delay]

        [message]
            speaker=Anlindë
            message= _ "... As you command, <i>my lord</i>."
        [/message]

        {UNLOCK_VIEW}

        {CLEAR_VARIABLE active_seal_glyphs,seal_glyphs,found_central_chamber,glyph_scrying_progress}
    [/event]
[/scenario]

#undef TSOL_SENTRY
#undef TSOL_DZOMBIE
#undef TSOL_DISABLE_WATER_SOUND_SOURCES
#undef TSOL_DECLARE_SEAL_GLYPH
#undef TSOL_SET_UP_GUARD_SIDE
#undef TSOL_AREA_DESCRIPTION_UNIT
#undef TSOL_OBJECTIVE_GLYPHS
#undef TSOL_INITIAL_OBJECTIVES
#undef TSOL_UPDATE_OBJECTIVES

# kate: indent-mode normal; encoding utf-8; space-indent on;
