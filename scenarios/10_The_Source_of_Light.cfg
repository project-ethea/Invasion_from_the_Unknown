#textdomain wesnoth-Invasion_from_the_Unknown

[scenario]
    id=10_The_Source_of_Light
    name= _ "The Source of Light"
    {MAP 10_The_Source_of_Light.map}
    {TURNS 60 59 58}
    next_scenario=11_Strike_on_New_Knalga
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC "nunc_dimittis.ogg"}

    {UNDERGROUND_VOLCANO_DEFAULT}

    {STORYTXT_THE_SOURCE_OF_LIGHT}
    {STORYMAP_THE_SOURCE_OF_LIGHT}

    {DEATHS_COMMON}

    [side]
        type=Elvish Hero
        id=Galas
        name= _ "Galas"
        unrenamable=yes
        side=1
        canrecruit=yes
        controller=human
        team_name=good
        user_team_name= _ "team_name^Elves"
        shroud=yes
    [/side]

    # Demons
    [side]
        side=2
        id=Mena
        name= _ "Mena"
        type=Demon Warrior
        canrecruit=yes
        unrenamable=yes
        gender=female
        recruit=Demon,Demon Grunt,Demon Zephyr,Chaos Hound,Automaton,Blood Imp,Imp
        {GOLD 225 250 275}
        {INCOME 3 4 5}
        {CHAOS_FLAG}
        team_name=demons
        user_team_name= _ "team_name^Demons"
        [ai]
            village_value=0.2
            aggression=1.0
            caution=0.0
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]
    [/side]

    # Undead at NE chambers
    [side]
        side=3
        income=-10
        recruit=Walking Corpse,Soulless,Vampire Bat,Ghost,Mudcrawler
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=0.8
            caution=0.2
            village_value=0.4
            grouping=defensive
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]
    [/side]

    # Fire spirits at SE chambers
    [side]
        side=4
        income=-10
        recruit=Fire Wisp,Fire Spirit
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=defensive
        [/ai]
    [/side]

    # Ghosts at SW chambers
    [side]
        side=5
        income=-10
        recruit=Ghost,Animated Rock,Fire Wisp,Mudcrawler,Walking Corpse,Giant Leech
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=defensive
        [/ai]
    [/side]

    # Water spirits at NW chambers
    [side]
        side=6
        income=-10
        recruit=Water Tidal,Water Spirit,Walking Corpse,Mudcrawler,Water Serpent
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=defensive
            recruitment_ignore_bad_combat=yes
        [/ai]
    [/side]

    # Various creeps
    [side]
        side=7
        gold=0
        income=-2
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=no
        [/ai]
    [/side]

    # Special event creeps
    [side]
        side=8
        gold=0
        income=-2
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=no
        [/ai]
    [/side]

    # Elynia
    [side]
        side=9
        gold=0
        income=-2
        no_leader=yes
        team_name=good
        {HIDDEN_TEAM}
    [/side]

    {STARTING_VILLAGES 1 6}
    {STARTING_VILLAGES 2 6}

    [event]
        name=prestart
        {PLAYER_RECRUITMENT_SETUP_FOR_SCENARIO 10}
        # Recall heroes
        # wmllint: recognize Anlindë
        {RECALL_POS Anlindë 48 3}
        # wmllint: recognize Mal Keshar
        {RECALL_POS (Mal Keshar) 48 2}
        # wmllint: recognize Althurin
        {RECALL_POS Althurin 49 4}
        [role]
            role=boyscout
            type=Elvish Forefather,Nightgaunt,Spectre,Elvish Ancestor,Elvish Outrider,Shadow,Wraith,Elvish Rider,Ghost,Elvish Scout,Elvish Warrior Spirit
        [/role]
        [role]
            role=magic_one
            side=1
            type=Elvish Shyde,Elvish Sylph,Elvish Enchantress,Elvish Druid,Elvish Sorceress,Elvish Shaman
            [not]
                id=Anlindë
            [/not]
        [/role]
        [recall]
            x,y=50,3
            role=magic_one
        [/recall]
        [recall]
            role=boyscout
        [/recall]

        # Initialize variables
        # Glyphs's toggles - each glyph has a relative to central chamber location associated
        {VARIABLE tsl_glyph_1 off} # N
        {VARIABLE tsl_glyph_2 off} # NE
        {VARIABLE tsl_glyph_3 off} # SE
        {VARIABLE tsl_glyph_4 off} # S
        {VARIABLE tsl_glyph_5 off} # SW
        {VARIABLE tsl_glyph_6 off} # NW
        # Items
        {VARIABLE took_drainer no}
        {VARIABLE took_berserker no}
        {VARIABLE met_igor no}

        # Create some minibosses depending on difficulty
        {DIFF
        (
            {EX_LOYAL_UNIT Automaton () () 2 31 16}
            {EX_LOYAL_UNIT (Iron Golem) () () 2 30 14}
        )
        (
            {EX_LOYAL_UNIT Goliath () () 2 32 36}
            {EX_LOYAL_UNIT (Iron Golem) () () 2 30 14}
        )
        (
            {EX_LOYAL_UNIT Goliath () () 2 32 36}
            {EX_LOYAL_UNIT Goliath () () 2 37 37}
        )
        }
        # Create creep guards around
        {ANONYMOUS_GUARD (Leech) 7 27 6}
#ifndef EASY
        {ANONYMOUS_GUARD (Leech) 7 33 7}
#endif
        {ANONYMOUS_GUARD (Leech) 7 21 17}
        {ANONYMOUS_GUARD (Leech) 7 22 24}
        {ANONYMOUS_GUARD (Leech) 7 41 24}
        {ANONYMOUS_GUARD (Leech) 7 29 42}
#ifndef EASY
        {ANONYMOUS_GUARD (Eyestalk) 7 39 31}
#endif
        {ANONYMOUS_GUARD (Eyestalk) 7 19 39}
        {ANONYMOUS_GUARD (Eyestalk) 7 30 38}
        {ANONYMOUS_GUARD (Eyestalk) 7 33 45}
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 25 43}
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 39 45}
        {ANONYMOUS_GUARD (Mudcrawler) 7 34 47}
        {ANONYMOUS_WC_GUARD saurian 7 15 31}
#ifndef EASY
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 3 8}
#endif
        {ANONYMOUS_GUARD (Giant Leech) 7 3 16}
#ifdef HARD
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 5 18}
#endif
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 10 8}
#ifdef EASY
        {ANONYMOUS_GUARD (Mudcrawler) 7 7 5}
#else
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 7 5}
#endif
        {ANONYMOUS_WC_GUARD drake 7 17 3}
        {ANONYMOUS_WC_GUARD drake 7 19 8}
#ifdef NORMAL
        {ANONYMOUS_GUARD (Giant Leech) 7 20 10}
#else
#ifdef HARD
        {ANONYMOUS_GUARD (Brain Drainer) 7 20 10}
#endif
#endif
        {ANONYMOUS_GUARD (Giant Leech) 7 9 4}
        {ANONYMOUS_GUARD (Giant Leech) 7 5 11}
        {ANONYMOUS_GUARD (Giant Ant) 7 16 8}
#ifndef EASY
        {ANONYMOUS_GUARD (Giant Ant) 7 16 11}
#endif
        {ANONYMOUS_GUARD (Giant Ant) 7 26 6}
        {ANONYMOUS_GUARD (Giant Ant) 7 33 3}
        {ANONYMOUS_GUARD (Giant Scorpion) 7 36 4}
#ifndef EASY
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 31 5}
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 36 11}
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 38 12}
#endif
        {ANONYMOUS_GUARD (Giant Ant) 7 8 35}
        {ANONYMOUS_GUARD (Giant Ant) 7 23 37}
        {ANONYMOUS_GUARD (Giant Ant) 7 48 8}
        {ANONYMOUS_GUARD (Giant Ant) 7 47 9}
        {ANONYMOUS_GUARD (Giant Ant) 7 47 8}
        {ANONYMOUS_GUARD (Eyestalk) 7 39 8}
        {ANONYMOUS_GUARD (Giant Ant) 7 24 21}
        {ANONYMOUS_GUARD (Giant Ant) 7 24 22}
        {ANONYMOUS_GUARD (Blood Bat) 7 23 32}
        {ANONYMOUS_WC_GUARD dwarf 7 25 30}
        {ANONYMOUS_SOULLESS_GUARD dwarf 7 38 27}
        {ANONYMOUS_WC_GUARD wose 7 35 9}
        {ANONYMOUS_WC_GUARD bat 7 30 34}
        {ANONYMOUS_WC_GUARD bat 7 33 33}
        {ANONYMOUS_WC_GUARD bat 7 27 32}
        {ANONYMOUS_SOULLESS_GUARD wose 7 28 40}
        {ANONYMOUS_GUARD (Fungoid) 7 20 41}
        {ANONYMOUS_GUARD (Fungoid) 7 34 20}
        {ANONYMOUS_GUARD (Fungoid) 7 25 36}
        {ANONYMOUS_GUARD (Fungoid) 7 23 30}
        {ANONYMOUS_GUARD (Fungoid) 7 35 42}
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 3 2}
#ifndef EASY
        {ANONYMOUS_GUARD (Dread Bat) 7 23 13}
        {ANONYMOUS_GUARD (Blood Bat) 7 10 6}
        {ANONYMOUS_GUARD (Vampire Bat) 7 9 11}
#endif
        {ANONYMOUS_GUARD {DIFF (Vampire Bat) (Blood Bat) (Blood Bat)} 7 39 20}
        {ANONYMOUS_GUARD (Giant Scorpion) 7 45 41}
        {ANONYMOUS_GUARD (Giant Ant) 7 22 20}
        {ANONYMOUS_WC_GUARD drake 7 29 44}

        [objectives]
            side=1
            {OBJECTIVE_TO_WIN ( _ "Find the 'Source of Light'")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            x,y=50,3
            message= _ "It is...an enormous power. It fills the entire place!"
        [/message]
        {MSG_UNIT (Mal Keshar) ( _ "I feel it. It is the Source of Light. Her presence is weak in comparison to when she was on the surface, but still strong nonetheless.")}
        {MSG_UNIT Anlindë ( _ "She is here. We have arrived, finally...")}
        {MSG_UNIT Galas ( _ "You magic-skilled people can perceive things which are beyond me.")}
        {MSG_UNIT Althurin ( _ "Indeed, lad. Magic experience grants ye the ability to perceive the existence of things which are ignored by common folk. My runic detectors indicate that an ancient magic affects these tunnels, a magic unknown to dwarves of the present age.")}
        {MSG_UNIT Galas ( _ "Fair enough, find the Source. We should not waste too much time in this search, for we do not know when those fiends will let themselves fall upon Knalga.")}
        {MSG_UNIT (Mal Keshar) ( _ "If they have not already.")}
        {MSG_UNIT Althurin ( _ "I hope they haven't. Our economy is thrivin', but it's still less than adequate for supportin' us in a full-scale war.")}
        {QUAKE (rumble.ogg)}
        [message]
            role=boyscout
            message= _ "Less chatter and more scouting, people, before the walls cave in on us!"
        [/message]
    [/event]

    [event]
        name=attack
        [filter]
            type=Goliath
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {MSG_SPEAKER second_unit ( _ "Surely I could use some help here!")}
        {MSG_SPEAKER unit ( _ "Die, microscopic vermin!")}
    [/event]

    [event]
        name=sighted
        [filter]
            side=2
        [/filter]
        [if]
            [have_unit]
                id=Mena
            [/have_unit]
            [then]
                {MSG_SPEAKER unit ( _ "The elves! Damn, the rearguard could not hold against them!")}
                {MSG_UNIT Mena ( _ "Persistent fools. But it matters little; we shall destroy them, shan't we? For the Emperor!")}
                {MSG_SPEAKER second_unit ( _ "Oh.")}
                {MSG_UNIT Galas ( _ "They must be after our savior. They want to stop us!")}
                {MSG_UNIT (Mal Keshar) ( _ "Their master must be aware of what fate lies in store for them if we call upon the power of the Union. And it looks like they have a never-ending supply of grunt attackers, too.")}
                {MSG_UNIT Galas ( _ "We must try to defeat this group now, before they can invoke reinforcements and secure these caves. I hope we can manage it.")}

                [objectives]
                    side=1
                    {OBJECTIVE_TO_WIN ( _ "Defeat the demon leader")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                    {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
                [/objectives]
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Mena
        [/filter]

        [message]
            speaker=unit
            message= _ "Oh, Master... I have...failed..."
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=Mena
        [/filter]

        {MSG_SPEAKER second_unit ( _ "Die, you fiend! And stay dead!")}

        {QUAKE (cave-in.ogg)}

        # Open path to central chamber
        [terrain]
            terrain=Uh
            x,y=29-30,18
        [/terrain]
        [terrain]
            terrain=Uh
            x,y=34-35,18
        [/terrain]
        [terrain]
            terrain=Uu^Uf
            x=32,33
            y=18,19
        [/terrain]
        [terrain]
            x=31
            y=18
            terrain=Rp
        [/terrain]
        [terrain]
            x=36-39
            y=18
            terrain=Qxu # wmllint: ignore
        [/terrain]

        {MSG_SPEAKER second_unit ( _ "Oooh! What the... Hey, look! The cave wall there has raised!")}
        [remove_shroud]
            {RECT 28 16 36 20}
        [/remove_shroud]
        {REDRAW}
        [scroll_to]
            x,y=31,19
        [/scroll_to]
        {DELAY 400}
        {MSG_UNIT (Galas) ( _ "Let's continue.")}
        {SCROLL_TO $x1 $y1}

        [objectives]
            side=1
            {OBJECTIVE_TO_WIN ( _ "Explore the main chamber and find the 'Source of Light'")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
        [/objectives]

        [event]
            name=moveto
            [filter]
                side=1
                {RECT 22 19 41 34}
            [/filter]

            {QUAKE (cave-in.ogg)}
            {QUAKE (rumble.ogg)}

            [terrain]
                terrain=Ryd # wmllint: ignore
                x=24,25-26
                y=7 ,8
            [/terrain]

            # Awake chamber guards (sides 3, 4, 5, 6), giving them leaders who can recruit, gold, and loyal guards
            [modify_side]
                side=3
                {GOLD 50 75 100}
            [/modify_side]
            [unit]
#ifndef EASY
                type=Soulless
#else
                type=Walking Corpse
#endif
                variation=wose
                canrecruit=yes
                side=3
                unrenamable=yes
                x,y=49,21
            [/unit]
            {ANONYMOUS_SOULLESS_GUARD troll 3 45 20}
#ifndef EASY
            {ANONYMOUS_SOULLESS_GUARD troll 3 53 21}
#endif
#ifdef HARD
            {ANONYMOUS_SOULLESS_GUARD troll 3 47 12}
#endif
            {ANONYMOUS_WC_GUARD wose 3 45 14}
#ifndef EASY
            {ANONYMOUS_WC_GUARD drake 3 49 14}
            {ANONYMOUS_WC_GUARD saurian 3 46 16}
#endif
            {ANONYMOUS_GUARD (Brain Drainer) 3 56 24}
#ifdef HARD
            {ANONYMOUS_GUARD (Giant Leech) 3 53 31}
#endif
            {ANONYMOUS_WC_GUARD drake 3 53 25}
            {ANONYMOUS_GUARD {DIFF (Blood Bat) (Blood Bat) (Dread Bat)} 3 49 25}
#ifdef HARD
            {ANONYMOUS_GUARD (Blood Bat) 3 54 26}
#endif
            {ANONYMOUS_GUARD (Vampire Bat) 3 43 12}
            {ANONYMOUS_GUARD (Blood Bat) 3 51 13}
            {ANONYMOUS_WC_GUARD wose 3 45 15}
            {ANONYMOUS_WC_GUARD dwarf 3 42 18}
            {ANONYMOUS_WC_GUARD dwarf 3 45 21}
#ifndef EASY
            {ANONYMOUS_GUARD Skeleton 3 51 18}
#endif
            {ANONYMOUS_GUARD Skeleton 3 50 28}
#ifdef HARD
            {ANONYMOUS_GUARD (Skeleton Archer) 3 48 28}
#endif
            {ANONYMOUS_GUARD Ghoul_C 3 49 31}
            {ANONYMOUS_GUARD (Walking Corpse) 3 50 31}
            {ANONYMOUS_GUARD Ghoul_C 3 45 28}
#ifdef HARD
            {ANONYMOUS_GUARD Ghoul_C 3 49 27}
#endif
            {CAPTURE_VILLAGE 3 (45-52) (17-24)}

            [modify_side]
                side=4
                {GOLD 50 75 100}
            [/modify_side]
            [unit]
                type=Fire Spirit
                canrecruit=yes
                side=4
                unrenamable=yes
                x,y=55,47
            [/unit]
            {ANONYMOUS_WC_GUARD drake 4 54 41}
#ifndef EASY
            {ANONYMOUS_WC_GUARD drake 4 50 44}
#endif
            {ANONYMOUS_WC_GUARD drake 4 50 42}
#ifdef HARD
            {ANONYMOUS_WC_GUARD drake 4 43 43}
            {ANONYMOUS_GUARD (Fire Wisp) 4 47 39}
#endif
            {ANONYMOUS_GUARD (Fire Wisp) 4 41 50}
#ifndef EASY
            {ANONYMOUS_GUARD (Fire Wisp) 4 55 45}
#endif
            {ANONYMOUS_GUARD {DIFF (Fire Wisp) (Fire Spirit) (Fire Spirit)} 4 44 47}
            {ANONYMOUS_GUARD (Fire Wisp) 4 39 45}
            {ANONYMOUS_GUARD {DIFF (Fire Wisp) (Fire Spirit) (Fire Spirit)} 4 44 49}
            {ANONYMOUS_GUARD {DIFF (Fire Wisp) (Fire Spirit) (Fire Spirit)} 4 38 36}
#ifdef HARD
            {ANONYMOUS_GUARD (Fire Wisp) 4 44 38}
#endif
            {ANONYMOUS_GUARD (Fire Wisp) 4 41 41}
#ifndef EASY
            {ANONYMOUS_GUARD (Fire Wisp) 4 47 35}
#endif
            {ANONYMOUS_WC_GUARD drake 4 50 36}
            {ANONYMOUS_WC_GUARD troll 4 54 39}
#ifdef HARD
            {ANONYMOUS_WC_GUARD wose 4 49 40}
            {ANONYMOUS_WC_GUARD drake 4 43 41}
            {ANONYMOUS_WC_GUARD troll 4 45 40}
#endif
            {ANONYMOUS_WC_GUARD mounted 4 48 48}
#ifdef HARD
            {ANONYMOUS_WC_GUARD saurian 4 51 50}
#endif
            {ANONYMOUS_WC_GUARD saurian 4 53 48}
#ifndef EASY
            {ANONYMOUS_WC_GUARD drake 4 41 47}
#endif
#ifdef NORMAL
            {ANONYMOUS_WC_GUARD wose 4 42 32}
            {ANONYMOUS_WC_GUARD drake 4 41 35}
#else
#ifdef HARD
            {ANONYMOUS_SOULLESS_GUARD wose 4 42 32}
            {ANONYMOUS_SOULLESS_GUARD drake 4 41 35}
#endif
#endif
            {CAPTURE_VILLAGE 4 (42-54) (35-46)}

            [modify_side]
                side=5
                {GOLD 50 75 100}
            [/modify_side]
            # Golem leader
            [unit]
                type=Rock Golem
                canrecruit=yes
                side=5
                unrenamable=yes
                x,y=11,47
            [/unit]
            [unit]
                type=Rock Golem
                id=Glyph Guard Golem
                side=5
                unrenamable=yes
                x,y=10,46
            [/unit]
            # This special golem cannot move around, but has great defense ratios
            [object]
                silent=yes
                [filter]
                    id=Glyph Guard Golem
                [/filter]
                [effect]
                    apply_to=movement
                    set=1
                [/effect]
                [effect]
                    apply_to=movement_costs
                    replace=true
                    [movement_costs]
                        deep_water={UNREACHABLE}
                        shallow_water={UNREACHABLE}
                        reef={UNREACHABLE}
                        swamp_water={UNREACHABLE}
                        flat={UNREACHABLE}
                        sand={UNREACHABLE}
                        forest={UNREACHABLE}
                        hills={UNREACHABLE}
                        mountains={UNREACHABLE}
                        village={UNREACHABLE}
                        castle={UNREACHABLE}
                        cave={UNREACHABLE}
                        frozen={UNREACHABLE}
                        unwalkable={UNREACHABLE}
                        impassable={UNREACHABLE}
                        fungus={UNREACHABLE}
                    [/movement_costs]
                [/effect]
                [effect]
                    apply_to=defense
                    replace=true
                    [defense]
                        cave=30
                        impassable=20
                        hills=30
                        mountains=20
                        fungus=30
                    [/defense]
                [/effect]
            [/object]

            {ANONYMOUS_GUARD (Animated Rock) 5 6 44}
#ifndef EASY
            {ANONYMOUS_GUARD (Animated Rock) 5 11 43}
#endif
            {ANONYMOUS_GUARD (Animated Rock) 5 7 48}
#ifdef HARD
            {ANONYMOUS_GUARD (Rock Golem) 5 6 40}
#endif
            {ANONYMOUS_GUARD (Animated Rock) 5 2 39}
            {ANONYMOUS_GUARD (Animated Rock) 5 6 37}
            {ANONYMOUS_GUARD (Animated Rock) 5 10 32}
#ifndef EASY
            {ANONYMOUS_GUARD (Dread Bat) 5 8 39}
#endif
#ifdef HARD
            {ANONYMOUS_GUARD (Dread Bat) 5 1 36}
            {ANONYMOUS_GUARD (Ghoul_C) 5 9 44}
#endif
            {ANONYMOUS_GUARD (Giant Mudcrawler) 5 7 45}
            {ANONYMOUS_SOULLESS_GUARD saurian 5 9 48}
            {ANONYMOUS_WC_GUARD wose 5 3 39}
            {ANONYMOUS_WC_GUARD wose 5 8 46}
            {ANONYMOUS_WC_GUARD dwarf 5 12 45}
#ifndef EASY
            {ANONYMOUS_GUARD (Ghost) 5 5 35}
#endif
#ifdef HARD
            {ANONYMOUS_GUARD (Ghost) 5 3 43}
#endif
            {CAPTURE_VILLAGE 5 (4-16) (42-50)}

            [modify_side]
                side=6
                {GOLD 50 75 90}
            [/modify_side]
            [unit]
#ifndef HARD
                type=Water Serpent
#else
                type=Cuttle Fish
#endif
                canrecruit=yes
                side=6
                unrenamable=yes
                x,y=7,27
            [/unit]
            {ANONYMOUS_WC_GUARD swimmer 6 1 25}
            {ANONYMOUS_WC_GUARD saurian 6 2 28}
#ifdef HARD
            {ANONYMOUS_SOULLESS_GUARD swimmer 6 6 29}
            {ANONYMOUS_WC_GUARD swimmer 6 11 26}
#endif
            {ANONYMOUS_WC_GUARD swimmer 6 14 23}
            {ANONYMOUS_WC_GUARD saurian 6 15 29}
#ifndef EASY
            {ANONYMOUS_WC_GUARD swimmer 6 12 28}
            {ANONYMOUS_WC_GUARD swimmer 6 15 19}
#endif
            {ANONYMOUS_WC_GUARD saurian 6 20 16}
            {ANONYMOUS_WC_GUARD saurian 6 11 27}
            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 9 27}
            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 20 28}
            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 12 26}

            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 15 28}
            {ANONYMOUS_GUARD (Water Spirit) 6 4 26}
            {ANONYMOUS_GUARD (Water Tidal) 6 4 30}
            {ANONYMOUS_GUARD (Water Tidal) 6 20 25}
            {ANONYMOUS_SOULLESS_GUARD swimmer 6 1 27}
            {ANONYMOUS_SOULLESS_GUARD wose 6 3 27}
            {CAPTURE_VILLAGE 6 (4-13) (24-30)}

            # Change music to a more calm, yet sinister theme
            [music]
                name=snowfall.ogg
                immediate=yes
            [/music]

            # Unshroud central chamber
            [remove_shroud]
                x=24-38
                y=19-31
            [/remove_shroud]

            {MSG_UNIT Galas ( _ "The earth shakes! It must be a volcanic eruption!")}
            {MSG_UNIT (Mal Keshar) ( _ "No, it is not. We are just awakening the forces of nature by merely being here. Which indicates no one has been in these caves for a very long time, possibly for millions of years.")}
            {MSG_UNIT Anlindë ( _ "Except the Lady of Light, whose energy comes from the walls at the center of the chamber!")}
            {MSG_UNIT (Mal Keshar) ( _ "Right... This was her final resting place. She bound and sealed herself within this chamber, for she probably thought nobody would need her again. Hmph. An elegant manner of killing oneself temporarily, indeed.")}
            {MSG_UNIT Galas ( _ "What should we do? These walls are impassable!")}
            {MSG_UNIT (Mal Keshar) ( _ "There must be a way to open these walls. The chamber is shaped around a hexagonal center, and its corners look strangely clean. The runes carved in each one of them must indicate something, and being all different in each corner, it might mean that we have to activate them from six different places, away from the chamber.")}
            {MSG_UNIT Althurin ( _ "Yes, runic glyphs! They activate on contact, and the most important chambers, gates, and tunnels were designed to be opened with this same sort of glyph. But, where are they?")}
            {MSG_UNIT Galas ( _ "We'll have to explore to find their locations.")}
            {MSG_UNIT (Mal Keshar) ( _ "We ought to be careful. We are not welcome here. I can sense dangerous creatures of all kinds roaming about.")}
            [objectives]
                side=1
                {OBJECTIVE_TO_WIN ( _ "Find the 6 glyphs that should open the central chamber.")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
            [/objectives]
            {VARIABLE tcx 0}
            [event]
                name=new turn
                first_time_only=no
                [if]
                    {VARIABLE_NUM_LESS_THAN tcx 3}
                    [then]
                        {VARIABLE_INC tcx}
                    [/then]
                [/if]
            [/event]
            [event]
                name=new turn
                first_time_only=no
                [if]
                    {VARIABLE_NUM_EQUALS tcx 2}
                    [then]
                        {MSG_UNIT (Mal Keshar) ( _ "Perhaps if I can concentrate for a while, I could figure out the location of each glyph.")}
                        {MSG_UNIT Galas ( _ "Really? That would be a great help.")}
                        [objectives]
                            side=1
                            {OBJECTIVE_TO_WIN ( _ "Find the 6 glyphs that should open the central chamber.")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
                            {OBJECTIVE_NOTES ( _ "Let Mal Keshar rest for three turns and he'll reveal the location of each magic glyph.")}
                        [/objectives]
                        {VARIABLE located_glyphs no}
                        {VARIABLE resting_tcx 0}
                        [event]
                            name=new turn
                            first_time_only=no
                            [if]
                                {VARIABLE_BOOLEAN_EQUALS located_glyphs no}
                                [then]
                                    [store_unit]
                                        [filter]
                                            id=Mal Keshar
                                        [/filter]
                                        kill=no
                                        variable=mal_keshar_probe
                                    [/store_unit]
                                    [if]
                                        {VARIABLE_BOOLEAN_EQUALS mal_keshar_probe.resting yes}
                                        [then]
                                            {VARIABLE_INC resting_tcx}
                                        [/then]
                                        [else]
                                            # Reset and wait for new unit rest cycle
                                            {VARIABLE resting_tcx 0}
                                        [/else]
                                    [/if]
                                    {CLEAR_VARIABLE mal_keshar_probe}
                                [/then]
                            [/if]
                        [/event]
                        [event]
                            name=new turn
                            first_time_only=no
                            [if]
                                {VARIABLE_BOOLEAN_EQUALS located_glyphs no}
                                {VARIABLE_NUM_GREATER_OR_EQUAL_THAN resting_tcx 3}
                                [then]
                                    {VARIABLE located_glyphs yes}
                                    # Central chamber goal glyphs
                                    # North
                                    [remove_shroud]
                                        {RECT 15 1 22 4}
                                    [/remove_shroud]
                                    # North-east
                                    [remove_shroud]
                                        {RECT 45 12 49 15}
                                    [/remove_shroud]
                                    # South-east
                                    [remove_shroud]
                                        {RECT 49 47 54 50}
                                    [/remove_shroud]
                                    # South
                                    [remove_shroud]
                                        {RECT 22 38 27 43}
                                    [/remove_shroud]
                                    # South-west
                                    [remove_shroud]
                                        {RECT 8 44 12 48}
                                    [/remove_shroud]
                                    # North-west
                                    [remove_shroud]
                                        {RECT 0 24 5 29}
                                    [/remove_shroud]
                                    {MSG_UNIT (Mal Keshar) ( _ "Ah. Got it.")}
                                    {REDRAW}
                                    {SCROLL_TO 19 2}
                                    {DELAY 500}
                                    {SCROLL_TO 47 13}
                                    {DELAY 500}
                                    {SCROLL_TO 52 48}
                                    {DELAY 500}
                                    {SCROLL_TO 24 40}
                                    {DELAY 500}
                                    {SCROLL_TO 10 46}
                                    {DELAY 500}
                                    {SCROLL_TO 2 26}
                                    {DELAY 500}
                                    {MSG_UNIT Anlindë ( _ "My thanks. This will ease our search greatly. Now we just have to find a way to get to each location.")}
                                    [objectives]
                                        side=1
                                        {OBJECTIVE_TO_WIN ( _ "Activate the 6 glyphs that should open the central chamber.")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                                        {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
                                    [/objectives]
                                [/then]
                            [/if]
                        [/event]
                    [/then]
                [/if]
            [/event]
            [event]
                name=victory
                {CLEAR_VARIABLE resting_tcx}
                {CLEAR_VARIABLE tcx}
                {CLEAR_VARIABLE located_glyphs}
            [/event]
        [/event]
    [/event]

    # Macro to simplify the process of defining each glyph's base events
#define TSL_GLYPH_EVENT X Y GLYPHNUM
    [item]
        x,y={X},{Y}
        image=scenery/rune{GLYPHNUM}.png
    [/item]
    [event]
        name=moveto
        [filter]
            side=1
            x,y={X},{Y}
        [/filter]
        {VARIABLE (tsl_glyph_{GLYPHNUM}) ("on")}
        [removeitem]
            x,y={X},{Y}
        [/removeitem]
        [item]
            x,y={X},{Y}
            image=scenery/rune{GLYPHNUM}-glow.png
        [/item]
        {REDRAW}
        {MSG_NARRATOR ( _ "Glyph activated.")}
    [/event]
#enddef

    # Central chamber goal glyphs
    # North
    {TSL_GLYPH_EVENT 19 2  1}
    # North-east
    {TSL_GLYPH_EVENT 47 13 2}
    # South-east
    {TSL_GLYPH_EVENT 52 48 3}
    # South
    {TSL_GLYPH_EVENT 24 40 4}
    # South-west
    {TSL_GLYPH_EVENT 10 46 5}
    # North-west
    {TSL_GLYPH_EVENT  2 26 6}

#undef TSL_GLYPH_EVENT

    # And their secondary events - not all of them have one
    [event]
        name=moveto
        [filter]
            side=1
            x,y=47,13
        [/filter]

        [terrain]
            x,y=47,10-11
            terrain=Uu
        [/terrain]
        [terrain]
            x=43   ,50,51
            y=10-11,9 ,10
            terrain=Qxu # wmllint: ignore
        [/terrain]

        {MSG_NARRATOR ( _ "A wall moves.")}
    [/event]

    # Elynia awakening event - relies on user performing a movement
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [allow_undo]
        [/allow_undo]
        [if]
            [variable]
                name=tsl_glyph_1
                equals="on"
            [/variable]
            [and]
                [variable]
                    name=tsl_glyph_2
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_3
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_4
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_5
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_6
                    equals="on"
                [/variable]
            [/and]
            [then]
                {ENDLEVEL_VICTORY yes}
            [/then]
        [/if]
    [/event]

    [event]
        name=victory
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_BLUE () }
        {QUAKE (cave-in.ogg)}
        {DELAY 400}
        {QUAKE (cave-in.ogg)}
        {QUAKE (cave-in.ogg)}

        {MSG_NARRATOR ( _ "All glyphs activated. The earth shakes!")}

        {QUAKE (rumble.ogg)}
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_BLUE () }
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_BLUE () }
        [terrain_mask]
            x,y=25,21
            {MASK 10_The_Source_of_Light.mask}
            [rule]
                new=_s # wmllint: ignore
                use_old=yes
            [/rule]
        [/terrain_mask]
        {REDRAW}
        # Elynia's bodyguards
        {ANONYMOUS_GUARD (Wose) 9 29 26}
        [+unit]
            {FACING_REVERSE}
        [/unit]
        {ANONYMOUS_GUARD (Wose) 9 33 26}
        {ANONYMOUS_GUARD (Wose) 9 30 24}
        [+unit]
            {FACING_REVERSE}
        [/unit]
        {ANONYMOUS_GUARD (Wose) 9 32 24}
        {ANONYMOUS_GUARD (Wose) 9 30 27}
        [+unit]
            {FACING_REVERSE}
        [/unit]
        {ANONYMOUS_GUARD (Wose) 9 32 27}

        # Unshroud central chamber
        [remove_shroud]
            {RECT 22 20 39 32}
        [/remove_shroud]

        [scroll_to]
            x,y=31,26
        [/scroll_to]

        {DELAY 750}

        {MSG_UNIT Galas ( _ "This is it!")}

        {MSG_UNIT (Mal Keshar) ( _ "She is there, let us go.")}

        {MSG_UNIT Anlindë ( _ "I have been waiting for this for too long.")}

        [teleport]
            [filter]
                id=Althurin
            [/filter]
            x,y=27,27
        [/teleport]
        [teleport]
            [filter]
                id=Galas
            [/filter]
            x,y=27,26
        [/teleport]
        [teleport]
            [filter]
                id=Mal Keshar
            [/filter]
            x,y=27,25
        [/teleport]
        [teleport]
            [filter]
                id=Anlindë
            [/filter]
            x,y=28,26
        [/teleport]
        [teleport]
            [filter]
                id=Igor
            [/filter]
            x,y=28,27
        [/teleport]
        [unit]
            type=Skeleton Archer
            upkeep=full
            x,y=28,25
            side=1
        [/unit]
        {SET_FACING (
            x=27-28
            y=25-27
        ) (se)}

        [scroll_to]
            x,y=31,26
        [/scroll_to]
        {DELAY 500}

        [message]
            x,y=28,25
            message= _ "Hello there! Anybody at home?"
        [/message]

        [message]
            type=Wose
            message= _ "Intruders! Protect the Lady of Light!"
        [/message]

        [sound]
            name=magic-holy-4.ogg
        [/sound]
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_WHITE () }

        [message]
            x,y=28,25
            message= _ "Argh!! Yelp..."
        [/message]

        [kill]
            x,y=28,25
            animate=yes
        [/kill]

        {MSG_UNIT (Mal Keshar) ( _ "Woses in this place? How odd.")}

        [message]
            type=Wose
            message= _ "Destroy the necromancer!!"
        [/message]

        {MSG_UNIT (Mal Keshar) ( _ "Huh? Nay, prepare to meet *your* fate, you...")}

        {MSG_UNIT Anlindë ( _ "Stop! We are the Elves of the Valley of Elynia. You must let us pass!")}

        [message]
            type=Wose
            message= _ "The elvish race was extinguished by the events after the Fall. You cannot be elves. Impostors!"
        [/message]

        {MSG_UNIT Igor ( _ "Aaah, they're gonna crush us!")}

        {MSG_UNIT Anlindë ( _ "I call upon the powers of Light! May they awaken our savior from her millennial sleep!")}

        [sound]
            name=magic-holy-2.ogg
        [/sound]
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_WHITE () }
        # Open to suggestions. I'm not very romantic, ain't I? Huh? What the hell.
        {MSG_NARRATOR ( _ "As Anlindë pronounced the spell, the great tree at the center of the chamber disappeared and a beautiful elven lady materialized in its place, lying on the grass floor. Big dragonfly wings on her back, and pale red hair and eyes made it obvious that she was not any elf, but the Lady of Light. Half-asleep, her powers were still strong enough to illuminate the surroundings without requiring any effort from her.")}
        [terrain]
            x,y=31,26
            terrain=Ggf # wmllint: ignore
        [/terrain]
        {REDRAW}
        [unit]
            side=9
            canrecruit=yes
            type=Lady of Light
            gender=female
            id=Elynia
            name= _ "Elynia"
            x,y=31,26
            {FACING_REVERSE}
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_DEXTROUS}
            [/modifications]
        [/unit]
        {REDRAW}
        [scroll_to]
            x,y=31,26
        [/scroll_to]
        {DELAY 1000}

        {MSG_UNIT Elynia ( _ "Who has...awakened me?")}

        [message]
            id=Galas
            message= _ "We are..."
        [/message]

        {MSG_UNIT Elynia ( _ "Elves? Ehm... That's not possible. I may be still asleep...")}

        [message]
            id=Mal Keshar
            message= _ "Actually, no."
        [/message]

        {MSG_UNIT Elynia ( _ "A necromancer? No, I do not allow any of your kind in my dreams! Say your last words!")}

        {MSG_UNIT Anlindë ( _ "No, wait a second...")}

        # Let's have some fun :-)
        [store_unit]
            [filter]
                id=Mal Keshar
            [/filter]
            kill=no
            variable=malin_store
        [/store_unit]

        [sound]
            name=magic-holy-1.ogg
        [/sound]
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_WHITE () }

        [kill]
            fire_event=no
            animate=yes
            id=Mal Keshar
        [/kill]

        [item]
            x=$malin_store.x
            y=$malin_store.y
            image=units/spirits/fire-death6.png
        [/item]

        {MSG_UNIT Galas ( _ "She's... she is...")}
#define MSG_MALIN_DUST TEXT
    [scroll_to]
        x=$malin_store.x
        y=$malin_store.y
    [/scroll_to]
    [message]
        speaker=narrator
        image=units/spirits/fire-death6.png
        caption= _ "Mal Keshar"
        message={TEXT} # wmllint: ignore
    [/message]
#enddef
        {MSG_MALIN_DUST ("`" + _"(pile of dust laying on the ground)
She's lovely.")}

        {MSG_UNIT Elynia ( _ "Well, thank you. You have awoken me, then. May I know who you are and what it is you want?")}

        {MSG_UNIT Galas ( _ "I am Galas, leader of the elves who inhabited your valley, my Lady. This is...")}

        {MSG_UNIT Althurin ( _ "Althurin, High Dwarven Runemaster to the Kingdom of Knalga.")}

        {MSG_UNIT Anlindë ( _ "Anlindë, First Advisor of Galas.")}

        {MSG_UNIT Igor ( _ "I'm Igor. I'm afraid I don't have any interesting occupations nowadays...")} # :-(   <- ESR's Terminal Frowney of Death

        {MSG_MALIN_DUST ( _ "Mal Keshar, necromancer extraordinaire and sort of a burned pile of bones. Could you quit your chatter and restore my old body?")}

        {MSG_UNIT Elynia ( _ "I was certainly not informed of having a valley of my own. And why should I help one of your kind, necromancer?")}

        {MSG_UNIT Anlindë ( _ "Actually, he has assisted us along the way to find you, my lady, and saved our lives multiple times. You are the Lady of Light, are you not?")}

        {MSG_UNIT Elynia ( _ "That is what my people used to call me. And how can I trust your word, dreadful cultist?")}

        {MSG_UNIT Galas ( _ "What?")}

        {MSG_UNIT Elynia ( _ "I might have been asleep for all this time but my memory still serves me very well, Galas. I can sense Telchior's blood flowing through your veins - he was a real fool by sparing the life of this elf. But I suppose we could set our differences aside and talk. Why did you come here? What do you need?")}

        {MSG_UNIT Galas ( _ "After you parted ways with our people, and those now known as desert elves, we found a new home in a valley located in the far East, which we named in your honor and lived there for a long time. However, recent events forced us to flee from there and find a new home. That is when we met Keshar...")}

        {MSG_MALIN_DUST (_"Mal Keshar, please.")}

        {MSG_UNIT Galas ( _ "...and he led us here to ask you for help in our war against those vile creatures called 'demons'...")}

        {MSG_UNIT Elynia ( _ "The what? Demons!? But...but... That's impossible! We sealed Yanqui, closed the portal, and made sure they would never return!")}

        {MSG_UNIT Galas ( _ "Yanqui? I do not understand...")}

        {MSG_UNIT Anlindë ( _ "It is a sad history that was forbidden to be told to new generations. You would not understand it and the huge implications those events bring.")}

        {MSG_UNIT Elynia ( _ "True enough. But you cannot blindly face an unknown enemy on the battlefield - that would only bring you a harsh defeat. These are not regular foes. These are wicked monsters that do not feel, do not listen, and most certainly do not love.")}

        {MSG_NARRATOR ( _ "A minute of silence followed.")}

        {MSG_UNIT Elynia ( _ "I can feel the suffering of your people. I know... Those creatures almost destroyed the last remnants of the elvish civilization. We are facing the danger of extermination at their hands.")}

        {MSG_UNIT Elynia ( _ "And you, necromancer Mal Keshar. I long sought to destroy you for your crimes. You attacked innocent travelers, peaceful villages, and attempted to put an end to the orcish tribes of the North, even when they were a part of the Northern Alliance! But you are tired of your evil ways. Your soul is corrupted, but you seek redemption - I feel it. Malin the Damned.")}

        {MSG_MALIN_DUST (_"The last person who called me that had a rather unpleasant death - but I bet you know that, too.")}

        {MSG_UNIT Elynia ( _ "I thought for a second that you would be grateful if I restored your body, but...")}

        {MSG_MALIN_DUST (_"No, no, no! Do it, please! This position is very uncomfortable for me. I swear that I'll do anything for you. Anything!")}

#undef MSG_MALIN_DUST
        {FLASH_GREEN ()}
        [unstore_unit]
            variable=malin_store
            find_vacant=yes
        [/unstore_unit]
        {FULL_HEAL (id=Mal Keshar)}
        [store_unit]
            variable=malin_store
            kill=yes
            [filter]
                id=Mal Keshar
            [/filter]
        [/store_unit]
        [unstore_unit]
            variable=malin_store
            find_vacant=yes
            {COLOR_HEAL}
            text=$malin_store.hitpoints
        [/unstore_unit]
        [removeitem]
            x=$malin_store.x
            y=$malin_store.y
        [/removeitem]
        {CLEAR_VARIABLE malin_store}
        {REDRAW}
        [sound]
            name=heal.wav
        [/sound]

        {MSG_UNIT (Mal Keshar) ( _ "Ahhh. Much better!")}

        {MSG_UNIT Galas ( _ "My lady, have you met the demons before?")}

        {MSG_UNIT Elynia ( _ "Not in great numbers. The only demon I ever met was a powerful ruler of their kind... What, Anlindë? I hope you understand that we cannot continue to conceal that episode of our lives from Galas and this necromancer. They need to know the nature of the forces they have encountered. So, the time to tell the story of the demon lord Yanqui has come.")}

        {MSG_UNIT Anlindë ( _ "I am not sure it is necessary. You may not trust me, and I do not care, but I really do not wish to see such conflicts occur again!")}

        {MSG_UNIT Elynia ( _ "I trust this brave warrior. Very few can face and survive a slaughter, and not lose their sanity. As for you, Anlindë, you know well the story so it does not matter. And the necromancer does not represent any authority for other elves - whatever he says will not be taken into account by them - so he is not a threat, as far as I am concerned.")}

        [if]
            [have_unit]
                side,id=1,Igor
            [/have_unit]
            [then]
                {MSG_UNIT Igor ( _ "Should I just...go?")}

                {MSG_UNIT Elynia ( _ "Hmm... You are a lonely goblin. I guess it would not hurt if you listen as well. Your people may have forgotten the history, but I see no problem in teaching it to you. Perhaps someday you may return to them and remind them of the horrors of the past which we should all avoid in the future. For good.")}

                {MSG_UNIT Igor ( _ "Oh, many thanks Lady! I have never been treated as an equal by non-goblins! Many thanks!")}
            [/then]
        [/if]

        {MSG_UNIT Elynia ( _ "No other elf should listen to this conversation. Now, you will probably want to sit down on the grass to relax and listen. This is a very long history that you ought to know.")}

        [store_unit]
            [filter]
                race=elf
                [and]
                    [not]
                        id=Galas
                    [/not]
                    [not]
                        id=Anlindë
                    [/not]
                [/and]
            [/filter]
            variable=other_elves_store
            kill=yes
        [/store_unit]

        {FOREACH other_elves_store i}
            {VARIABLE other_elves_store[$i].x recall}
            {VARIABLE other_elves_store[$i].y recall}

            [unstore_unit]
                variable=other_elves_store[$i]
            [/unstore_unit]
        {NEXT i}

        {CLEAR_VARIABLE other_elves_store}

        {MSG_NARRATOR ( _ "Galas ordered the rest of his kinsmen to patrol the caves, while Mal Keshar commanded his minions to protect the main chamber and make sure no one could listen in on the conversation they were having with Elynia.")}

        {REDRAW}
        {DELAY 750}

        {MSG_UNIT Elynia ( _ "We should start with the old story of the Golden Age. The continent was mostly dominated by humans, who had established the Empire of Wesnoth eons ago in the Central lands. The elves were distributed throughout the northeastern, northwestern, and southwestern forests, although small groups also wandered around Wesnoth or lived in the smaller forested areas. The dwarves controlled all the mountains, hills, and so forth, usually competing with the fierce orcs and trolls who also favored those regions, and trading their precious ores with us elves, and the humans of Wesnoth.")}

        {MSG_UNIT Elynia ( _ "The forests south of the Dwarven Kingdom of Knalga were known as the Wesmere forest. Eons ago, they established themselves as the sole authority for elves of all other countries. We valued our sages for their knowledge, more than for their age, martial skill, or magic power - although power comes from knowledge, and knowledege from age, more often than not.")}

        {MSG_UNIT Elynia ( _ "The elves that lived there considered knowledge the most valuable thing in the world, they were highly enthusiastic in investigating every secret world had to offer. Each and every one, including the darkest ones... Though that gave our civilization a great deal of order, discipline, and safety for eons, it would not last forever.")}

        {MSG_UNIT Elynia ( _ "Still, the first step toward chaos was taken by the humans of Wesnoth. More specifically, by the Emperor of Wesnoth, who demanded the creation of a second sun right after a major invasion of undead, led by the necromancer there by your side...")}

        {MSG_UNIT (Mal Keshar) ( _ "Hey, I was targeting orcs, not humans or elves. You just got in my way as always.")}

        {MSG_UNIT Elynia ( _ "Indeed. But that would be because the orcs whom you fought against were part of an ancient alliance established amongst the civilizations of the northern lands. Your pointless skirmishes are partly to blame for the sad condition of this Continent at present. And for some reason, the Emperor of Wesnoth issued the decree with specific instructions to conceal his witless decision from me, while I was in the field trying to locate *you*. He rejected my duty as his advisor!")}

        {MSG_UNIT Elynia ( _ "I could do nothing since I was too far from Wesnoth to stop the ritual. They gathered all their magi, students and masters alike, to obtain the power necessary to lift a mountain and fixate its path in the skies. That is your second sun, Naia. Created with the sole purpose of destroying darkness and evil forever. And it certainly worked for a time, but not forever.")}

        {MSG_UNIT Elynia ( _ "Many centuries later, something horrible occurred in the elvish lands. No one that is still alive remembers exactly how it happened, nor would they want to, for the most skilled sorcerers of Wesmere had somehow opened a portal to a different world during one of their many experiments. But things went awry, and they awoke an evil and powerful force along with it. This force adopted the form of a young elf seer and became the incarnation known as Yanqui. He told them that a great evil was going to swallow the lands and destroy the elvish civilization in its entirety, taking with it all the knowledge they had collected over the years.")}

        {MSG_UNIT Elynia ( _ "Predictably enough, he said that he would protect them if they worshiped him as a god. He also promised them unlimited knowledge and power to seal the pact - just what they had always wanted. Ambition blinded the minds of the Lords of Wesmere, so they agreed to the pact, even though Yanqui demanded blood sacrifices as a part of it. Those who disagreed with the decision of the Ka'lian died as the first sacrifices to the demon lord.")}

        {MSG_UNIT Elynia ( _ "For a long time, these events remained a secret to the rest of the world, including the foreign elvish lands. The Ka'lian used any means necessary to make sure that the news would not spread out of Wesmere. But something else was happening in non-elvish lands...")}

        {MSG_UNIT Elynia ( _ "The Emperor that ruled Wesnoth in those days died of poisoning six years after Yanqui's appearance in Wesmere. Some thought that he effectively committed suicide. Others were certain that he would not have done such a thing, and that the new Emperor of Wesnoth - a nobleman by the name of Dantair, whom I met a decade or two before - was behind it. He confirmed those fears himself, just two years after the beginning of his rule, when he demanded the creation of a third sun describing it as 'an essential step allowing for further growth and prosperity in Wesnoth'. He was so confident in the power of Wesnoth's magi and in his own political influence that he believed people would recognize him as a 'rightful' ruler once a third sun was in the sky.")}

        {MSG_UNIT Elynia ( _ "But his confidence was too great. Since no necromancers or chaotic orcs had actually threatened Wesnoth's safety during the centuries since Naia's creation, the orders of the magi had grown corrupt, and very few humans continued the serious pursuit of magic. The masters of old had passed away, and the new apprentices who came to take their place were a lazy and arrogant bunch. Nonetheless, Dantair went ahead with his plan.")}

        {MSG_UNIT Igor ( _ "Bloody politicians. They always manage to manipulate and convince people into doing crazy things!")}

        {MSG_UNIT Elynia ( _ "When the rumors reached me, I made haste to force him to give up. However, he must have predicted that, since he sent some of his best troops to stop me from reaching him. When I finally arrived at the valley of Weldyn, it was too late. The creation of Gaia was being attempted and, to my heart's pain, I witnessed all that transpired that fateful day.")}

        {MSG_UNIT (Mal Keshar) ( _ "Ugh...that day. I had to move to another home since mine was...")}

        {MSG_UNIT Elynia ( _ "If you'll let me continue... As I said, the human magi's mastery of magic arts was not as strong as it used to be, and their attempt to lift and send Gaia to the skies was a total disaster. Their powers were not great enough to tether Gaia high in the skies, so the mountain fell, crashing down onto Weldyn, the empire's capital, and giving rise to a huge cataclysm that destroyed cities, valleys, and even mountains. The earth-shattering force of the impact reshaped the land and altered even the coastline. All that was beautiful and of worth was ruined. I quickly returned to my home in Lintanir, the northeastern elvish forest, in an attempt to keep order amidst the chaos.")}

        {MSG_UNIT Elynia ( _ "The humans struggled to survive, the prey of panic, and they swiftly killed the Emperor, the magi, and their families in response to their acts. I suppose that for the most of the ignorant citizens, magic was turned into taboo. Horrible wars flared amongst elves, dwarves, orcs, and trolls altogether. Each kind would fight the other for the scarce resources left, except us... At least, for a time.")}

        {MSG_UNIT Elynia ( _ "Naia and Sela scorched all known lands drying up rivers and lakes, fields and forests. Yanqui's power made Wesmere Forest stand intact, however; green and seemingly peaceful. But he demanded unnatural sacrifices once more, and the Ka'lian agreed to his demands and executed his orders. All foreign species, including elves from other forests, were declared heretics, not worthy of living.")}

        {MSG_UNIT Elynia ( _ "So, as creatures from other races, or elves from foreign forests came to Wesmere seeking shelter, the dark cultists sacrificed them to Yanqui. The pain and agony were feeding him, making his power stronger and stronger. When no more refugees came there out of fear, he ordered raiding parties organized to search for elves, humans, orcs, or whatever they could find in the outside lands.")}

        {MSG_UNIT Elynia ( _ "We, the elves of the Lintanir forest, had to abandon our home for it would support life no longer. And so Argan and I led my people out of the northern forests. We eventually stumbled upon the Wesmere Forest.")}

        {MSG_UNIT Elynia ( _ "Unaware of the corruption at the forest's heart, we decided to ask refuge of the Ka'lian. However, we were ambushed at night during our travel to the capital. Many of us died, elders and children included. Either killed during the fight, or kidnapped and sacrificed for Yanqui, as my husband Argan would later find out. He risked his own life to reach the capital and spy on the cultists.")}

        {MSG_UNIT Elynia ( _ "So we found ourselves faced with a difficult choice - stop our brethren, the Wesmere elves, and free them from the great evil at all costs, or flee to safety and let them continue their rule of cruelty, and eventually control the whole continent. Painfully, I chose the first and started the lengthy War of Wesmere. That was the last war fought on the Continent, for we were the last civilization still standing back then, to the best of my knowledge.")}

        {MSG_UNIT Elynia ( _ "Even though our numbers were superior, their religious frenzy, obsession, and fear of destruction almost led the Wesmere elves to victory. We fought with all our might, but that only called upon the fury of the demon lord, who eventually appeared in his true form to attack us from the skies.")}

        {MSG_UNIT Elynia ( _ "With little chance of prevailing, Argan and I had to call upon the power of the Union, risking destruction by our own power. The Union of the Darkness and the Light was not powerful enough to destroy the demon, however, at least not entirely for his powers of regeneration were stronger.")}

        {MSG_UNIT Elynia ( _ "Finally we managed to tear apart his body, sealing all the pieces with magic, then sent them back to the underworld, destroying the portal as our final act. Victory was ours. Wesmere, however, was a wreck, nothing living remained in the forest except for a few survivors - less than one hundred elves. The few remaining Wesmere elves surrended and begged for forgiveness. We spared the civilians' lives, but most priests and warriors left were executed and burned to ashes. We could not risk the possibility of another civil war, and we had to prevent the priests from summoning forces from the underworld again at all costs.")}

        {MSG_UNIT Elynia ( _ "It is ironic how we elves have always despised humans because of their moral, intellectual, and physical inferiority. The humans may have doomed all the world of Irdya to chaos, but our own kin were the only ones responsible for the end of the ancient elvish civilization. Though our civilization rarely suffers from a lapse in judgement, the fact that the results are always enormously catastrophic is unsettling. That is why I fear this may happen yet again. Yanqui was not the first false spiritual guide that inflicted massive harm on our people, but certainly the worst.")}

        {MSG_UNIT Elynia ( _ "To keep our civilization in one piece, we had to forbid telling the story, and execute anyone who would dare to tell it. But we were never sure whether we had killed every cultist or not. Of course, we know that one of them escaped execution, since one of the commanders spared her life... She assured him that she was just a simple, ignorant follower, not a devout cultist. I felt she had to be executed, but unfortunately, the rest of my people did not agree.")}

        {MSG_UNIT Galas ( _ "Anlindë? But...but, she...")}

        {MSG_UNIT Anlindë ( _ "I was a priestess, yes, but not willing. He would have killed me and the rest of my family if I had rejected his rule! Of course, at the end, he killed them nonetheless. I realize now that I only delayed their inevitable fate.")}

        {MSG_UNIT Althurin ( _ "Why did the elves part ways?")}

        {MSG_UNIT Elynia ( _ "Anlindë wanted them to return to the Northeast. She said that we should have explored the unknown instead of retreating south. Of course, not every commander agreed, so eventually we went our separate ways, leaving both sides feeling wronged. Argan and I decided that our people no longer needed us, for Telchior and Anlindë would not listen to us. Quetor'el went south with his small group, but after the war I felt too weakened to travel with them across the desert. So Argan and I came here, to the depths, to live in peace. I am still surprised that Telchior and Anlindë managed to find a valley with life in the far East - I was wrong after all.")}

        {MSG_UNIT Elynia ( _ "However, on the way to this place, an earthquake tore a rift in the ground near us. Argan fell into the darkness, and I could not follow him... Faithfully, I waited years and years for him... I thought he could have survived that disaster...he always managed to escape the worst situations... But then, I realized that I was waiting for the impossible. I decided to sleep for the rest of eternity, since I...needed him. And he was no more.")}

        {MSG_UNIT Galas ( _ "That's...horrible...")}

        {MSG_UNIT (Mal Keshar) ( _ "My deepest condolences.")}

        {MSG_UNIT Anlindë ( _ "Then, all hope is lost...")}

        {MSG_UNIT Igor ( _ "Oh no, what are we gonna do now?")} # ;-(

        {MSG_UNIT Elynia ( _ "Don't despair. Although the force of the Union has been lost forever, I will try to help you in any way that is possible. Still, I can't avoid being disturbed by the fact that someone opened a portal and possibly summoned Yanqui back into this world. The person responsible must have known this history in some way...or did it by accident, which is far less likely. I certainly hope that the one who is orchestrating this chaos is not Yanqui himself, or any other being of his kind.")}

        {MSG_UNIT Althurin ( _ "The individual responsible for this may be related in some way to Yechnagoth. She also knew of Yanqui somehow, or that's what we had been told by our hero, Rogrimir.")}

        {MSG_UNIT Elynia ( _ "Yechnagoth, the Eater of Souls? But she's just an ancient legend told by mothers to scare their children - but with times as they are, I suppose you can expect anything.")}

        {MSG_UNIT Althurin ( _ "Aye. Accordin' to the history, the Quenoth desert elves led by Kalehssar - nephew of Tanuil, and direct descendant of Quetor'el - defeated her on an isle far to the west, in the middle of the Vast Sea. She could corrupt all souls from that place, includin' humans, orcs, nagas, and saurians. After bein' defeated, though, that influence was gone. But a large fraction of humans were still controlled by a powerful group of followers; I'd bet they are the ones behind this plot. The 'loyalists'. They probably want to expand their empire by takin' over these lands and others yet to be discovered.")}

        {MSG_UNIT Elynia ( _ "Interesting. So other elves survived and even managed to perform no small feat. But somehow I fear they did not really destroy her. It may have been a decoy; as far as I know, many ancient legends tell of brave, lonely heroes slaying her. If the existence of Yechnagoth turns out to be true, what can be said of those tales? Perhaps her power is greater than we could suspect.")}

        {MSG_UNIT Elynia ( _ "I also cannot believe that simple humans could control the forces of the underworld. There must be something more powerful behind this.")}

        {MSG_UNIT Anlindë ( _ "It is an intriguing matter, indeed. Unfortunately, the knowledge amassed by our people and the humans' lore masters has been lost forever. If only we could have accessed it; we might have been able to find a glimmer of light to guide us in this dark new world.")}

        {MSG_UNIT (Mal Keshar) ( _ "I think we should move and quit wasting time here. The world needs us!")}

        {MSG_UNIT Galas ( _ "Very well, let us go, I cannot wait to get out of these tunnels.")}

        {MSG_UNIT Anlindë ( _ "Neither can I.")}

        {MSG_UNIT Igor ( _ "We'll see the sunlight again? It's been so long... So long since I've seen the surface...")}

        [kill]
            animate=no
            id=Elynia
        [/kill]
        [unit]
            side=1
            canrecruit=no
            type=Lady of Light
            id=Elynia
            name= _ "Elynia"
            {IS_HERO}
            unrenamable=yes
            x,y=31,26
            {FACING_REVERSE}
            upkeep=loyal
            # Loyal, to herself :)
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_DEXTROUS}
            [/modifications]
        [/unit]

        {CLEAR_VARIABLE met_igor}
        {CLEAR_VARIABLE took_berserker}
        {CLEAR_VARIABLE took_drainer}
        {CLEAR_VARIABLE tsl_glyph_1}
        {CLEAR_VARIABLE tsl_glyph_2}
        {CLEAR_VARIABLE tsl_glyph_3}
        {CLEAR_VARIABLE tsl_glyph_4}
        {CLEAR_VARIABLE tsl_glyph_5}
        {CLEAR_VARIABLE tsl_glyph_6}
    [/event]

    [event]
        name=moveto
        [filter]
            x=1-20 ,13-20
            y=24-30,15-25
            side=1
        [/filter]
        {EX_REMOVE_SHROUD (
            {RECT 12 16 19 31}
            terrain="Ww,Wo"
        )}
        {REDRAW}
        {MSG_SPEAKER unit ( _ "Wow. This place has plenty of water, deep and shallow. The small fords should allow us to cross it, but they appear to be well guarded by water spirits and other creatures which have some affinity with water. This will not be easy, but shouldn't prove to be too hard.")}
    [/event]

    [event]
        name=moveto
        [filter]
            {RECT 38 34 50 40}
            [or]
                {RECT 40 45 54 50}
            [/or]
            [or]
                {RECT 50 40 55 46}
            [/or]
            [and]
                side=1
            [/and]
        [/filter]
        {REDRAW}
        {MSG_UNIT unit ( _ "There are lava streams down here from which hot air rises and warms this cave. Interesting - there must be a volcano near this cave system, or perhaps we are inside one.")}
    [/event]

    ################### DRAINING POTION ###################
    [item]
        x,y=2,4
        image=items/potion-poison.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=2,4
            side=1
        [/filter]
        [if]
            [and]
                [not]
                    [have_unit]
                        race=undead
                        x,y=$unit.x,$unit.y
                    [/have_unit]
                [/not]
                [not]
                    [have_unit]
                        race=elvish_spirits
                        x,y=$unit.x,$unit.y
                    [/have_unit]
                [/not]
                [not]
                    [have_unit]
                        race=bats
                        x,y=$unit.x,$unit.y
                    [/have_unit]
                [/not]
                [not]
                    [have_unit]
                        type=Faerie Spirit
                        x,y=$unit.x,$unit.y
                    [/have_unit]
                [/not]
            [/and]
            [and]
                {VARIABLE_BOOLEAN_EQUALS took_drainer no}
            [/and]
            [then]
                [message]
                    speaker=unit
                    message= _ "This strange potion bottle gives me the chills. A label with a skull on it makes it clear that it is a bad thing, but for some reason it does not smell like poison. This scroll I found next to it explains that it is a draining potion - that while it makes the drinker much weaker, but it also grants them the draining ability with their melee attacks. I am not sure if it is really worth the exchange, but draining my opponent's vital energy certainly attracts me."
                    [option]
                        message= _ "I think it is worthwhile. Let me have it."
                        [command]
                            {VARIABLE took_drainer yes}
                            {MSG_NARRATOR ( _ "The unit drinks the potion, feeling immediately dazed and confused. Then, its vital energy lowers but its melee weapons gain the draining specialty.")}
                            [removeitem]
                                x,y=2,4
                            [/removeitem]
                            {PLAY_SOUND poison.ogg}
                            [object]
                                [filter]
                                    x,y=2,4
                                [/filter]
                                duration=forever
                                id=Drainer Potion
                                name= _ "Drainer Potion"
                                image=icons/potion-green-4.png
                                description= _ "This potion adds the Draining ability to this unit's melee attacks, and makes it quite stronger against arcane attacks."
                                [effect]
                                    apply_to=attack
                                    range=melee
                                    [set_specials]
                                        mode=append
                                        {WEAPON_SPECIAL_DRAIN}
                                    [/set_specials]
                                [/effect]
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=-5%
                                [/effect]
                                [effect]
                                    apply_to=resistance
                                    replace=no
                                    [resistance]
                                        arcane=-10%
                                    [/resistance]
                                [/effect]
                            [/object]
                            {EX_LOYAL_UNIT (Giant Leech) () () 8 1 5}
                            {MSG_SPEAKER unit ( _ "Oh.")}
                        [/command]
                    [/option]
                    [option]
                        message= _ "On a second thought, I don't like the idea. It is revolting."
                    [/option]
                [/message]
            [/then]
            [else]
                [if]
                    {VARIABLE_BOOLEAN_EQUALS took_drainer no}
                    [then]
                        [message]
                            speaker=narrator
                            caption= _ "Drainer Potion"
                            image=icons/potion-green-4.png
                            message= _ "This potion would add the Draining ability to this unit's melee attacks, but only if it was a living unit. You might want to bring a living unit to it instead."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]

    ################### BERSERK POTION ###################
    [item]
        x,y=21,10
        image=items/potion-red.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=21,10
            side=1
        [/filter]

        {REDRAW}
        {ALLOW_UNDO}

        [if]
            {VARIABLE_BOOLEAN_EQUALS took_berserker no}
            [and]
                [have_unit]
                    x,y=$x1,$y1
                    [and]
                        [not]
                            type=Walking Corpse,Soulless,Ghoul,Ghoul_C,Necrophage
                        [/not]
                        [not]
                            type=Ghost,Wraith,Shadow,Spectre,Nightgaunt,Faerie Spirit
                        [/not]
                        [not]
                            type=Elvish Shaman,Elvish Druid,Elvish Shyde,Elvish Sorceress,Elvish Enchantress,Elvish Sylph
                        [/not]
                        [not]
                            id=Anlindë
                        [/not]
                        [not]
                            id=Mal Keshar
                        [/not]
                        [not]
                            race=elvish_spirits
                        [/not]
                        [not]
                            race=fairy
                        [/not]
                        [not]
                            race=bats
                        [/not]
                    [/and]
                [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=unit
                    message= _ "What a beautiful flask for a potion! Reddish in color, I open and smell it, and immediately feel euphoric and energized. It must be one of those ancient 'berserk' potions, which make the drinker stronger and frenetically lethal to their enemies. This implies many risks in combat, as berserk attacks don't allow you to get protection and so forth during combat. However, it might prove to be useful in our war against the demons."
                    [option]
                        message= _ "I'll take it. I do not fear death!"
                        [command]
                            {VARIABLE took_berserker yes}
                            [removeitem]
                                x,y=21,10
                            [/removeitem]
                            [object]
                                [filter]
                                    x,y=21,10
                                [/filter]
                                duration=level
                                id=Berserk Potion
                                name= _ "Berserk Potion"
                                image=icons/potion-red-1.png
                                description= _ "For the remainder of this scenario, this potion adds the Berserk ability to this unit's melee attacks (which also gain strength), and makes it stronger against impact, blade, and fire attacks. Also, the unit increases its maximum hitpoints by 10% of the current maximum."
                                [effect]
                                    apply_to=attack
                                    range=melee
                                    set_description={STR_BERSERK_ATTACK_NAME}
                                    increase_damage=1
                                    [set_specials]
                                        mode=append
                                        {WEAPON_SPECIAL_BERSERK}
                                    [/set_specials]
                                [/effect]
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=10%
                                    heal_full=yes
                                [/effect]
                                [effect]
                                    apply_to=resistance
                                    replace=no
                                    [resistance]
                                        impact=-30%
                                        blade=-10%
                                        fire=-20%
                                    [/resistance]
                                [/effect]
                            [/object]
                            {MSG_SPEAKER unit ( _ "Great! I now feel invincible!")}
                            {EX_LOYAL_UNIT (Imp) () () 2 19 11}
                            {EX_LOYAL_UNIT (Chaos Hound) () () 2 19 8}
                            {EX_LOYAL_UNIT (Demon) () () 2 22 8}
                            {MAKE_FACING_REVERSE}
                            [message]
                                x,y=22,8
                                message= _ "Oh really? Let's see if you really are invincible!"
                            [/message]
                            {MSG_SPEAKER unit ( _ "Uh-oh. I might be in trouble. Or perhaps not.")}
                        [/command]
                    [/option]
                    [option]
                        # FIXME: this text might be too much like a biased opinion of mine on berserkers!
                        message= _ "On the other hand, I do not want to give up control of my emotions during battle."
                    [/option]
                [/message]
            [/then]
            [else]
                [if]
                    [variable]
                        name=took_berserker
                        equals=no
                    [/variable]
                    [then]
                        [message]
                            speaker=narrator
                            caption= _ "Berserk Potion"
                            image=icons/potion-red-1.png
                            message= _ "This potion would add the Berserk ability to this unit's melee attacks, if only it was a strong and skillful fighter unit, living or not. Spirits certainly cannot count as strong fighters, since they don't even have a solid body. Elvish shamans and other faerie beings do not count either, lacking combat prowess. A bat should never use this kind of potion for digestive reasons."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]

    ################### TOUCH-PLATE 35,50 ###################
    {ITEM_TOUCHPLATE 35 50}
    [event]
        name=moveto
        [filter]
            side=1
            x,y=35,50
        [/filter]

        [removeitem]
            x,y=35,50
        [/removeitem]

        [terrain]
            x,y=24,41
            terrain=Ryd
        [/terrain]

        {MSG_NARRATOR _"Touchplate triggered. A magical gate opens."}

        [remove_shroud]
            {RECT 20 37 29 43}
            side=1
        [/remove_shroud]
        {REDRAW}
        {SCROLL_TO 24 41}
        {DELAY 750}
        {SCROLL_TO $x1 $y1}
    [/event]

    ################### IGOR'S HOME ###################
    {PLACE_IMAGE scenery/signpost.png 3 18}
    {PLACE_IMAGE items/burial.png 7 18}
    {PLACE_IMAGE items/burial.png 5 20}
    {PLACE_IMAGE items/orcish-flag.png 7 20}
    {PLACE_IMAGE items/burial.png 1 15}
    {PLACE_IMAGE scenery/underground_temple.png 8 19}
    [event]
        name=moveto
        [filter]
            side=1
            x,y=3,18
        [/filter]
        {ALLOW_UNDO}
        {REDRAW}
        [message]
            speaker=narrator
            image="scenery/signpost.png"
            message= _ "Go 'way!! We're like, closed or somethin'!!!"
        [/message]
        [message]
            speaker=unit
            message= _ "Um...okay."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x,y=8,19
            [and]
                race=bats
                [or]
                    type=Walking Corpse
                [/or]
                [or]
                    type=Soulless
                [/or]
            [/and]
        [/filter]
        [if]
            {VARIABLE_BOOLEAN_EQUALS met_igor no}
            [then]
                {MSG_NARRATOR ( _ "You have found a pretty interesting building, albeit crude in design. You may want to get a unit that is not a bat or walking corpse to check it out.")}
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x,y=8,19
            [not]
                race=bats
                [or]
                    type=Walking Corpse
                [/or]
                [or]
                    type=Soulless
                [/or]
            [/not]
        [/filter]
        [if]
            {VARIABLE_BOOLEAN_EQUALS met_igor no}
            [then]
                [message]
                    speaker=unit
                    message= _ "It is strange to find a house here in the deep, but it appears that someone lives there, judging by the condition of the exterior. The decorations to this cave also appear to be recent. What should I do - leave or see if somebody is still living there?"
                    [option]
                        message= _ "Shout and see."
                        [command]
                            {MSG_SPEAKER unit ( _ "Hellooooo! Anybody at home?")}
                            {MSG_NARRATOR ( _ "(silence)")}
                            {MSG_SPEAKER unit ( _ "I said HELLO!!!")}
                            {MSG_NARRATOR ( _ "(yet more silence)")}
                            [message]
                                speaker=unit
                                message= _ "Should I insist another time, or abandon the cave?"
                                [option]
                                    message= _ "Insist again."
                                    [command]
                                        {MSG_SPEAKER unit ( _ "Very well, let me break in...")}
                                        {MSG_NARRATOR ( _ "(*BOOM!!! CRASH!!! CRACK! CLANG! CRASH!!! BAM!!*)")}
                                        {MSG_SPEAKER unit ( _ "So, anybody at home now?")}
                                        [unit]
                                            id=Igor
                                            name= _ "Igor"
                                            side=1
                                            type=Wolf Rider
                                            profile="portraits/igor.png"
                                            unrenamable=yes
                                            moves=5
                                            resting=no
                                            upkeep=loyal
                                            x,y=8,19
                                            [modifications]
                                                {TRAIT_LOYAL}
                                                {TRAIT_STRONG}
                                            [/modifications]
                                        [/unit]
                                        {VARIABLE met_igor "yes"}
                                        {MSG_UNIT Igor ( _ "Awww. Can't I even find a safe place to live??")}
                                        {MSG_SPEAKER unit ( _ "A goblin? How did you get here?")}
                                        {MSG_UNIT Igor ( _ "It's a long story. I used to live in the northlands, in a small town with my fellows. However, it just so happened those foul 'loyalists' invaded it, ransacked it, killed my people, and left me with no home to live in. I couldn't believe I survived that night, I just wish they had the same luck. Fearing for my life, I decided to enter the caves and find the deepest one possible, looking for safety and peace.")}
                                        {MSG_UNIT Igor ( _ "So I found these caverns, and set up home here. However, the dang humans appeared again with their filthy cronies, but this time I managed to hide my cave from them. Now that you unhid it, I'll surely perish.")}
                                        {MSG_SPEAKER unit ( _ "I see. Well, would you like to perhaps follow us, rather than staying in these perilous pits? We could provide protection for you from the loyalists...")}
                                        {MSG_UNIT Igor ( _ "Oh really? Wait a second, let me prepare my baggage and I shall go with you!")}
                                        {MSG_SPEAKER unit ( _ "Very well.")}
                                    [/command]
                                [/option]
                                [option]
                                    message= _ "Abandon."
                                [/option]
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        message= _ "I think it would be safer to keep away from this cave."
                    [/option]
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        {ALLOW_UNDO}
        [filter]
            side=1,2
        [/filter]
        {VARIABLE_OP rumble_test random 1..35}
        [switch]
            variable=rumble_test
            [case]
                value=1
                {QUAKE (cave-in.ogg)}
            [/case]
            [case]
                value=2
                {QUAKE (rumble.ogg)}
            [/case]
        [/switch]
        {CLEAR_VARIABLE rumble_test}
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                [filter_adjacent_location]
                    terrain=*^Z/ # wmllint: ignore
                    [or]
                        terrain=*^Z\ # wmllint: ignore
                    [/or]
                [/filter_adjacent_location]
            [/filter_location]
        [/filter]
        {MSG_SPEAKER unit ( _ "Hmm... These gates seem to be magical in nature. They gently glow in a blueish tone, and I cannot even touch them.")}
        {MSG_UNIT (Galas) ( _ "There must be a way to open them somewhere.")}
    [/event]
[/scenario]
