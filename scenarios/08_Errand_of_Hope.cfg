#textdomain wesnoth-Invasion_from_the_Unknown

[scenario]
    id=08_Errand_of_Hope
    name= _ "An Errand of Hope"
    {MAP 08_Errand_of_Hope.map}
    {TURNS 32 30 28}
    next_scenario=08x_Interlude
    victory_when_enemies_defeated=no

    {UNDERGROUND}
    {SCENARIO_MUSIC "underground.ogg"}

    {STORYTXT_ERRAND_OF_HOPE}
    {STORYMAP_ERRAND_OF_HOPE}

    {DEATHS_COMMON}

    [side]
        type=Elvish Hero
        id=Galas
        name= _ "Galas"
        unrenamable=yes
        side=1
        canrecruit=yes
        controller=human
        team_name=good
        user_team_name= _ "team_name^Elves"
        shroud=yes
        {INCOME 13 11 8}
    [/side]

#define __KEEP_AWAY_FROM_PRECIPICE
    [avoid]
        {RECT 47 24 52 27}
    [/avoid]
#enddef

    # Althurin
    [side]
        no_leader=yes
        {DWARVISH_FLAG}
        side=2
        team_name=good
        user_team_name= _ "team_name^Dwarves"
        [ai]
            caution=0.6
            grouping=defensive
            {__KEEP_AWAY_FROM_PRECIPICE}
            village_value=0.1
        [/ai]
        {QUANTITY recruit
        (Dwarvish Ulfserker,Dwarvish Pathfinder,Dwarvish Scout,Dwarvish Steelclad,Dwarvish Runesmith,Dwarvish Fighter,Dwarvish Thunderwheel,Dwarvish Steamwheel,Dwarvish Thunderer,Dwarvish Flamethrower,Dwarvish Thunderguard)
        (Dwarvish Pathfinder,Dwarvish Scout,Dwarvish Runesmith,Dwarvish Fighter,Dwarvish Thunderwheel,Dwarvish Thunderer,Dwarvish Flamethrower)
        (Dwarvish Scout,Dwarvish Runesmith,Dwarvish Fighter,Dwarvish Thunderwheel,Dwarvish Thunderer)
        }
    [/side]

    # Other dwarves
    [side]
        no_leader=yes
        {DWARVISH_FLAG}
        side=3
        team_name=good
        user_team_name= _ "team_name^Dwarves"
        [ai]
            caution=0.3
            aggression=0.33
            grouping=defensive
            {__KEEP_AWAY_FROM_PRECIPICE}
            village_value=0.0
        [/ai]
        {QUANTITY recruit
        (Dwarvish Ulfserker,Dwarvish Pathfinder,Dwarvish Scout,Dwarvish Steelclad,Dwarvish Runesmith,Dwarvish Fighter,Dwarvish Thunderwheel,Dwarvish Steamwheel,Dwarvish Thunderer,Dwarvish Flamethrower,Dwarvish Thunderguard)
        (Dwarvish Pathfinder,Dwarvish Scout,Dwarvish Runesmith,Dwarvish Fighter,Dwarvish Thunderwheel,Dwarvish Thunderer,Dwarvish Flamethrower)
        (Dwarvish Scout,Dwarvish Runesmith,Dwarvish Fighter,Dwarvish Thunderwheel,Dwarvish Thunderer)
        }
    [/side]

    # Hazor
    [side]
        no_leader=yes
        side=4
        recruit=Demon,E2 Shaxthal Drone,Demon Zephyr,Chaos Hound,Chaos Invader,Chaos Invoker
        {CHAOS_FLAG}
        team_name=shadowm_minions
        user_team_name= _ "team_name^Loyalists"
        [ai]
            {__KEEP_AWAY_FROM_PRECIPICE}
            caution=0.0
            aggression=0.8
            {ATTACK_DEPTH 3 4 5}
            recruitment_pattern=scout,scout,fighter,mixed fighter,archer,archer,mixed fighter,fighter,scout
        [/ai]
    [/side]

    # Zoltar
    [side]
        no_leader=yes
        side=5
        recruit=Demon,Verlissh Spearbearer,Chaos Hound,Chaos Invader,Chaos Invoker,Chaos Headhunter
        {CHAOS_FLAG}
        team_name=shadowm_minions
        user_team_name= _ "team_name^Loyalists"
        [ai]
            {__KEEP_AWAY_FROM_PRECIPICE}
            caution=0.0
            aggression=1.0
            grouping=no
            {NO_SCOUTS}
            {ATTACK_DEPTH 3 4 5}
            recruitment_ignore_bad_movement=yes
            recruitment_pattern=scout,scout,fighter,mixed fighter,archer,archer,mixed fighter,fighter,scout
        [/ai]
    [/side]

    # Qwirg
    [side]
        no_leader=yes
        side=6
        {QUANTITY recruit
        (Troll Whelp,Young Ogre)
        (Troll Whelp,Young Ogre,Troll)
        (Troll,Troll Rocklobber,Young Ogre)
        }
        team_name=trolls
        user_team_name= _ "team_name^Trolls"
        [ai]
            {__KEEP_AWAY_FROM_PRECIPICE}
            caution=0.5
            aggression=1.0
            {ATTACK_DEPTH 2 3 4}
#ifdef HARD
            recruitment_pattern=fighter,mixed fighter,fighter,fighter,mixed fighter,fighter
#else
            recruitment_pattern=fighter
#endif
        [/ai]
    [/side]

    # Kwurg
    [side]
        id=Kwurg
        name= _ "Kwurg"
        type=Troll Warrior
        canrecruit=yes
        unrenamable=yes
        side=7
        {QUANTITY recruit
        (Troll Whelp,Young Ogre)
        (Troll Whelp,Young Ogre,Troll)
        (Troll,Troll Rocklobber,Young Ogre)
        }
        {INCOME 2 3 4}
        {GOLD 90 130 190}
        team_name=trolls
        user_team_name= _ "team_name^Trolls"
        [ai]
            {__KEEP_AWAY_FROM_PRECIPICE}
            caution=0.05
            aggression=1.0
            {ATTACK_DEPTH 2 2 3}
#ifdef HARD
            recruitment_pattern=fighter,mixed fighter,fighter,fighter,mixed fighter,fighter
#else
            recruitment_pattern=fighter
#endif
        [/ai]
    [/side]

    # Eela
    [side]
        side=8
        no_leader=yes
        team_name=unused
        {HIDDEN_TEAM}
        [ai]
            {__KEEP_AWAY_FROM_PRECIPICE}
            village_value=0
            aggression=0.8
            caution=0
            grouping=no
        [/ai]
    [/side]

    # Cave creatures
    [side]
        side=9
        no_leader=yes
        team_name=cavecreeps
        {HIDDEN_TEAM}
        [ai]
            {__KEEP_AWAY_FROM_PRECIPICE}
            village_value=0
            aggression=0.5
            caution=0
            grouping=no
        [/ai]
    [/side]

#define __OPEN_WATERY_PASSAGE_1
    [terrain]
        terrain=Uu
        x=29,30
        y=32,31
    [/terrain]
    [terrain]
        terrain=Wwf # wmllint: ignore
        x,y=31,31
    [/terrain]
#enddef

#define __OPEN_WATERY_PASSAGE_2
    [terrain]
        terrain=Wwf # wmllint: ignore
        x,y=30,22
    [/terrain]
#enddef

#define __OPEN_SIDE7_NW_PASSAGE
    [terrain]
        terrain=Uu^Uf
        x,y=38,27
    [/terrain]
    [terrain]
        terrain=Rr
        x,y=39,28
    [/terrain]
#enddef

#define __OPEN_SIDE7_NE_PASSAGE
    [terrain]
        terrain=Ryd # wmllint: ignore
        x,y=43,30
    [/terrain]
#enddef

    {STARTING_VILLAGES 7 4}

    # Decorations
    {PLACE_IMAGE (items/coffin-closed.png) 11 29}
    {PLACE_IMAGE (scenery/rock-cairn.png) 33 17}
    {PLACE_IMAGE (scenery/rock-cairn.png) 27 18}
    {PLACE_IMAGE (scenery/rock-cairn.png) 15 15}
    {PLACE_IMAGE (scenery/rock-cairn.png) 10 18}
    {PLACE_IMAGE (scenery/rock-cairn.png) 13 25}
    {PLACE_IMAGE (scenery/rock-cairn.png) 1 17}
    {PLACE_IMAGE (items/bones.png) 19 20}
    {PLACE_IMAGE (items/bones.png) 18 25}
    {PLACE_IMAGE (items/bones.png) 16 18}
    {PLACE_IMAGE (items/bones.png) 42 23}
    {PLACE_IMAGE (items/bones.png) 39 20}
    {PLACE_IMAGE (items/bones.png) 47 27}
    {PLACE_IMAGE (items/bones.png) 54 16}
    {PLACE_IMAGE (items/bones.png) 41 12}
    {PLACE_IMAGE (items/bones.png) 32 35}
    {PLACE_IMAGE (items/bones.png) 32 38}
    {PLACE_IMAGE (items/bones.png) 46 31}
    {PLACE_IMAGE (items/bonestack.png) 40 10}
    {PLACE_IMAGE (items/bonestack.png) 41 14}
    {PLACE_IMAGE (items/bonestack.png) 47 6}
    {PLACE_IMAGE (items/bonestack.png) 53 3}
    {PLACE_IMAGE (items/bonestack.png) 53 7}
    {PLACE_IMAGE (items/burial.png) 35 12}
    {PLACE_IMAGE (items/burial.png) 37 15}
    {PLACE_IMAGE (items/burial.png) 42 20}
    {PLACE_IMAGE (items/burial.png) 38 30}
    {PLACE_IMAGE (items/burial.png) 44 35}
    {PLACE_IMAGE (items/burial.png) 35 33}

    [event]
        name=prestart
        {PLAYER_RECRUITMENT_SETUP_FOR_SCENARIO 8}

        # Recall heroes
        {RECALL_POS Anlindë 25 42}
        {RECALL_POS (Mal Keshar) 25 43}

        {ELVISH_SUPPORTER (Supporter)}

        # Initialize variables
        {VARIABLE met_doom 0}

        [objectives]
            side=1
            {OBJECTIVE_TO_WIN ( _ "Explore the caves and defeat any enemies you find")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
        [/objectives]
    [/event]

    [event]
        name=start
        {MSG_SUF (role=Supporter) ( _ "These caves are too dark to see, even with our torches. And I do not feel well accompanied by the undead.")}

        {MSG_UNIT (Mal Keshar) ( _ "Are you elves afraid of the darkness? That's really amusing - for a race whose archers are said to be as accurate and deadly at night as they are under the light of the suns...")}

        {MSG_UNIT Galas ( _ "Where exactly are we, Mal Keshar?")}

        {MSG_UNIT (Mal Keshar) ( _ "Under these mountains, there was a dwarven kingdom, Knalga. A kingdom that was relocated and rebuilt countless times. I do not know if it still exists, but those smug midgets weren't very helpful to outsiders. So, unless their numbers are very reduced or they changed their minds after all this time isolated underground, do not expect any help from them.")}

        {MSG_UNIT Anlindë ( _ "I believe that they might agree to help us if we offer them something in exchange. If they are struggling to keep control of their underground domains, then they are most likely fighting trolls and other vermin, which we could wipe out of these tunnels with the help of the undead.")}

        {MSG_UNIT (Mal Keshar) ( _ "Or we could just get rid of those pesky dwarves if they interfer with our plans. You are actually expecting them to cooperate with a band of elves who work with necromancers?")}

        {MSG_UNIT Anlindë ( _ "We can try to negotiate with them. If we are to find the Lady of Light in this darkness, we'll need help from those who live in it. If that is not possible, then we might run out of provisions and never see the light of the suns again.")}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                [filter_adjacent_location]
                    terrain=*^Z/ # wmllint: ignore
                    [or]
                        terrain=*^Z\ # wmllint: ignore
                    [/or]
                [/filter_adjacent_location]
            [/filter_location]
        [/filter]
        {MSG_SPEAKER unit ( _ "Um... these gates seem to be magical in nature. They gently glow in a blueish tone, and I cannot even touch them.")}
    [/event]

    ##################### Someone falls down the abyss #####################
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x=48-49
            y=25
        [/filter]

        [if]
            [variable]
                name=met_doom
                numerical_not_equals=1
            [/variable]
            [then]
                [if]
                    [have_unit]
                        x=$x1
                        y=$y1
                        [not]
                            race=bats
                        [/not]
                        [not]
                            race=elvish_spirits
                        [/not]
                        [not]
                            type=Ghost,Shadow,Wraith,Nightgaunt,Spectre
                        [/not]
                    [/have_unit]
                    [then]
                        {VARIABLE met_doom 1}
                        {QUAKE (cave-in.ogg)}
                        [terrain]
                            x=48-49
                            y=25
                            terrain=Qxu # wmllint: ignore
                        [/terrain]
                        {REDRAW}
                        {MSG_NARRATOR ( _ "The cave's floor collapses, leaving the poor unit with no ground to stand on, thus falling down into the depths of the world. Who knows what fate awaits them at the chasm's bottom?")}
                        [message]
                            speaker=unit
                            message= _ "AAAAAAaaaaaaaaaaaaaaaaaaaahhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh..."
                        [/message]
                        [kill]
                            x,y=$x1,$y1
                            animate=yes
                            fire_event=no
                        [/kill]
                        [if]
                            {VARIABLE_LEXICAL_EQUALS unit.id "Galas"}
                            {OR {VARIABLE_LEXICAL_EQUALS unit.id "Anlindë"} }
                            {OR {VARIABLE_LEXICAL_EQUALS unit.id "Mal Keshar"} }
                            [then]
                                {ENDLEVEL_DEFEAT}
                            [/then]
                        [/if]
                    [/then]
                    [else]
                        [if]
                            [have_unit]
                                x=$x1
                                y=$y1
                                [not]
                                    race=bats
                                [/not]
                            [/have_unit]
                            [then]
                                [message]
                                    speaker=unit
                                    message= _ "Woah, the cave's floor here looks particularly weak."
                                [/message]
                            [/then]
                            [else]
                                [message]
                                    speaker=unit
                                    message= _ "Neep, neep, neeeeep! (translated: 'Cave floor weak, cave floor weak!')"
                                [/message]
                            [/else]
                        [/if]
                    [/else]
                [/if]
            [/then]
        [/if]
    [/event]

    ##################### Good elves meet trolls #####################
    [event]
        name=sighted
        [filter]
            race=troll
        [/filter]
        [filter_second]
            side=1
            race=elf
        [/filter_second]

        [message]
            speaker=unit
            message= _ "Elves? You treacherous ones, begone, now, or we kill you!"
        [/message]
    [/event]

    ##################### Good undead meet trolls #####################
    [event]
        name=sighted
        [filter]
            race=troll
        [/filter]
        [filter_second]
            side=1
            race=undead
            [or]
                race=bats
            [/or]
        [/filter_second]

        [message]
            speaker=unit
            message= _ "Undead! Begone creepy one, or we crush you!"
        [/message]
    [/event]

    # Poisonous bow
    {POISONOUS_BOW 44 29}

    # Player kills the initial troll leader
    [event]
        name=last breath
        [filter]
            canrecruit=yes
            side=7
        [/filter]
        {MSG_SPEAKER unit ( _ "Ugh. It hurts a lot...")}
    [/event]

    [event]
        name=die
        [filter]
            canrecruit=yes
            side=7
        [/filter]
        # Open the magic poisonous bow chamber
        {__OPEN_SIDE7_NE_PASSAGE}
        # Open the passage to the battlefield only
        {__OPEN_WATERY_PASSAGE_1}
        # Don't redraw yet...

        {MSG_UNIT Galas ( _ "Is it really necessary to do this? Kill every foe we stumble upon... Shouldn't there be another way?")}

        {MSG_UNIT (Mal Keshar) ( _ "Unless you want to suffer the same fate at their hands... no. Besides, they can become more helpful after passing on. He he.")}

        {MSG_UNIT Galas ( _ "Um...")}
    [/event]

    [event]
        name=moveto
        [filter]
            {RECT 8 16 27 25}
            side=1
        [/filter]
        # Open small water channel gate
        {__OPEN_WATERY_PASSAGE_2}
        # Open the other passage NW from the initial troll's keep
        {__OPEN_SIDE7_NW_PASSAGE}
        # Create leaders
        [unit]
            canrecruit=yes
            id=Qwirg
            name= _ "Qwirg"
            type=Great Troll
            {FACING_REVERSE}
            side=6
            unrenamable=yes
            random_traits=no
            x,y=51,8
        [/unit]
        [unit]
            canrecruit=yes
            id=Hazor
            name= _ "Hazor"
            type=Chaos Razerman
            side=4
            unrenamable=yes
            random_traits=no
            x,y=5,19
        [/unit]
        [unit]
            canrecruit=yes
            id=Zoltar
            name= _ "Zoltar"
            type=Chaos Lore
            side=5
            unrenamable=yes
            random_traits=no
            x,y=8,23
        [/unit]
        [unit]
            canrecruit=yes
            id=Althurin
            name= _ "Althurin"
            profile="portraits/althurin.png"
            type=Dwarvish Runemaster_alt
            {FACING_REVERSE}
            side=2
            unrenamable=yes
            random_traits=no
            x,y=24,14
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        [unit]
            canrecruit=yes
            id=Aetilaes
            name= _ "Aetilaes"
            type=Dwarvish Pathfinder
            side=3
            unrenamable=yes
            random_traits=no
            x,y=8,2
        [/unit]
        {SET_GOLD 2 120 95 60}
        {SET_GOLD 3 120 95 60}
        {SET_GOLD 4 100 150 180}
        {SET_GOLD 5 100 150 180}
        {SET_GOLD 6 90 120 160}
#define __EOH_UNIT _SIDE _TYPE _X _Y
    [unit]
        side={_SIDE}
        type={_TYPE}
        generate_name=yes
        random_gender=yes
        random_traits=yes
        x={_X}
        y={_Y}
        upkeep=loyal
    [/unit]
#enddef
        # Create fighters and other units for loyalists
        {__EOH_UNIT 4 (Demon) 11 19}
        {__EOH_UNIT 5 (Chaos Marauder) 9 21}
        {__EOH_UNIT 4 (Chaos Invoker) 13 17}
        {__EOH_UNIT 5 (Blood Imp) 11 25}
        {__EOH_UNIT 4 (Demonic Hound) 12 22}
        {__EOH_UNIT 4 (Chaos Invader) 14 22}
        {__EOH_UNIT 4 (Demon) 17 19}
        {__EOH_UNIT 5 (Verlissh Light Assault Trooper) 4 22}
        {__EOH_UNIT 4 (Demon Grunt) 18 26}
        {__EOH_UNIT 5 (Chaos Magus) 16 15}
        {__EOH_UNIT 4 (Dark Knight) 17 21}
        # Create fighters and other units for trolls
        {__EOH_UNIT 6 (Troll Rocklobber) 37 10}
        {MAKE_FACING_REVERSE}
#ifndef EASY
        {__EOH_UNIT 6 (Troll Rocklobber) 42 12}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll Rocklobber) 40 14}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Ogre) 38 8}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll Warrior) 31 12}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll Rocklobber) 39 11}
        {MAKE_FACING_REVERSE}
#endif
#ifdef HARD
        {__EOH_UNIT 6 (Troll Warrior) 43 10}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll Rocklobber) 46 13}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll Whelp) 35 11}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Ogre) 35 18}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll) 37 14}
        {MAKE_FACING_REVERSE}
#endif
        {__EOH_UNIT 6 (Troll) 45 8}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll Whelp) 38 11}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 6 (Troll) 35 13}
        {MAKE_FACING_REVERSE}
        # Create fighters and other units for allies
        {__EOH_UNIT 3 (Dwarvish Runesmith) 25 20}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 2 (Dwarvish Stalwart) 28 18}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 2 (Dwarvish Fighter) 23 18}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 3 (Dwarvish Steamwheel) 27 17}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 3 (Dwarvish Steelclad) 27 22}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 3 (Dwarvish Thunderguard) 28 15}
        {__EOH_UNIT 2 (Dwarvish Thunderguard) 32 18}
        {__EOH_UNIT 2 (Dwarvish Thunderer) 22 14}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 3 (Dwarvish Ulfserker) 27 15}
        {__EOH_UNIT 3 (Dwarvish Pathfinder) 30 18}
        {__EOH_UNIT 2 (Dwarvish Scout) 29 16}
        {__EOH_UNIT 2 (Dwarvish Ulfserker) 19 16}
        {MAKE_FACING_REVERSE}
        {__EOH_UNIT 3 (Dwarvish Guardsman) 32 14}
        {CLEAR_VARIABLE rand_facing}
        # Capture villages for trolls
        [capture_village]
            {RECT 45 3 53 12}
            side=6
        [/capture_village]
        # Capture villages for dwarves
        [capture_village]
            {RECT 15 13 27 21}
            side=2
        [/capture_village]
        [capture_village]
            {RECT 8 1 13 5}
            side=3
        [/capture_village]
        # Capture villages for loyalists
        [capture_village]
            {RECT 2 17 7 21}
            side=4
        [/capture_village]
        [capture_village]
            {RECT 3 22 10 26}
            side=5
        [/capture_village]
        # Remove shroud on the battlefield
        [remove_shroud]
            {RECT 10 14 27 26}
            side=1
        [/remove_shroud]
        [remove_shroud]
            {RECT 3 17 13 24}
            side=1
        [/remove_shroud]
        # Redraw and begin dialogue
        {REDRAW}
        {MSG_SPEAKER unit ( _ "Bright gods!")}
        {SCROLL_TO 12 23}
        {REDRAW}
        {DELAY 250}
        {SCROLL_TO 23 16}
        {REDRAW}
        {DELAY 250}
        {MSG_SUF (side=4,5) ( _ "What? It is impossible! The Goliath was supposed to have killed you all! How...")}
        {MSG_UNIT (Galas) ( _ "We defeated the Colossal Automaton, if that is what you're asking.")}
        {MSG_SUF (
            side=4
            canrecruit=yes
        ) ( _ "Argh... damn you, heathens. It is time for you to learn not to seek trouble from us anymore.")}
        {QUAKE (cave-in.ogg)}
        # The Master speaks. Damn, this is thrilling even me, the author :)
        [message]
            speaker=narrator
            caption= _ "Looming Voice coming from Everywhere"
            message= _ "If the Goliath could not deal with them, then finish them off yourselves!"
            image="units/unknown-unit.png~RC(magenta>{COLOR_YELLOW})"
        [/message]
        {QUAKE (rumble.ogg)}
        {PLAY_SOUND dwarf-laugh.wav}
        {MSG_SUF (
            side=5
            canrecruit=yes
        ) ( _ "Your command is Law, my liege.")}
        {MSG_UNIT (Mal Keshar) ( _ "Blasted humans. So they made it here before us, but wait... What is this? They are fighting with the dwarves!")}
        {MSG_SUF (race=dwarf) ( _ "Elves? And with undead marching amongst their ranks? 'Tis a strange sight indeed, for I thought that yer race was still an enemy of necromancy and their practitioners. Though, ye helped us when the trolls invaded our city centuries ago. Would ye help us now?")}
        {MSG_UNIT Galas ( _ "Centuries ago? I don't understand. Our people have never been out of our valley since the Fall!")}
        {MSG_SUF (race=dwarf) ( _ "What's that ye say? I always thought yer people came from the vast Southern Desert...")}
        {MSG_UNIT Anlindë ( _ "This explains a lot of things actually. We shall help you.")}
        {MSG_UNIT Galas ( _ "Anlindë?")}
        {MSG_UNIT Anlindë ( _ "Sssh.")}
        {MSG_SUF (race=dwarf) ( _ "Excellent. As ye can see, there are these foul men from the lands of Chaos, tryin' to take over our tunnels. But to our rear we have some rampant trolls who wish to do the same. It'd be a boon if ye can defeat both of 'em.")}
        {MSG_UNIT Anlindë ( _ "We shall do our best.")}
        [music]
            name=battle.ogg
            immediate=yes
        [/music]
        {MSG_UNIT Galas ( _ "What is going on? Elves from the desert? Anlindë, might they be...")}
        {MSG_UNIT Anlindë ( _ "I believe that is a discussion for another time, when we have finished our new job here.")}
        {MSG_UNIT Galas ( _ "Very well.")}
        {SCROLL_TO $x1 $y1}
        [objectives]
            side=1
            summary= _ "New objectives:"
            {OBJECTIVE_TO_WIN ( _ "Defeat all enemy leaders")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
        [/objectives]
        {VARIABLE temp_tcx 0}
        [event]
            name=new turn
            first_time_only=no
            [if]
                {VARIABLE_NUM_EQUALS temp_tcx 4}
                [have_unit]
                    id=Althurin
                [/have_unit]
                [then]
                    {MSG_UNIT Althurin ( _ "Friend elves, I must report this news to the king. Please stand fast, I shall be back with ye soon.")}
                    # Workaround to avoid side 2 being declared as loser,
                    # which would make them lose their captured villages.
                    [unit]
                        type=Dwarvish Fighter
                        alpha=0
                        x,y=40,1
                        side=2
                        random_traits=no
                        id=FAKEDWARFLEADER
                        canrecruit=yes
                        [status]
                            stone=on
                        [/status]
                        name=_"King Foo-Bar"
                        description=_"NO ONE SHOULD BE HERE
-- Shadow Master"
                    [/unit]
                    [store_unit]
                        [filter]
                            id=Althurin
                        [/filter]
                        variable=althurin_store
                        kill=yes
                    [/store_unit]
                    [move_unit_fake]
                        type=$althurin_store.type
                        side=$althurin_store.side
                        x=$althurin_store.x|,11
                        y=$althurin_store.y|,1
                    [/move_unit_fake]
                    {REDRAW}
                    {MSG_UNIT (Mal Keshar) ( _ "He just might be escaping from the battlefield...")}
                    {MSG_UNIT (Anlindë) ( _ "No... I don't think so. Dwarves have always been very war-like. They would not leave a battle just to let others do the dirty work, it would be going against their pride.")}
                [/then]
            [/if]
            [if]
                {VARIABLE_NUM_LESS_THAN temp_tcx 5}
                [then]
                    {VARIABLE_INC temp_tcx}
                [/then]
            [/if]
        [/event]
        [event]
            name=die
            [filter]
                id=Althurin
            [/filter]
            {MSG_SUF (side=3) ( _ "Althurin, sir. You are seriously injured!")}
            {MSG_UNIT Althurin ( _ "Argh... I need... I need to report this news to the king. I'm severely injured, but I hafta make it there. Please stand fast, friend elves. I shall be back with ye soon.")}
            # Workaround to avoid side 2 being declared as loser,
            # which would make them lose their captured villages.
            [unit]
                type=Dwarvish Fighter
                alpha=0
                x,y=40,1
                side=2
                random_traits=no
                id=FAKEDWARFLEADER
                name=_"King Foo-Bar"
                canrecruit=yes
                description=_"NO ONE SHOULD BE HERE
-- Shadow Master"
                [status]
                    stone=on
                [/status]
            [/unit]
            [store_unit]
                [filter]
                    id=Althurin
                [/filter]
                variable=althurin_store
                kill=yes
            [/store_unit]
            {VARIABLE althurin_store.hitpoints $althurin_store.max_hitpoints}
            [move_unit_fake]
                type=$althurin_store.type
                side=$althurin_store.side
                x=$althurin_store.x|,11
                y=$althurin_store.y|,1
            [/move_unit_fake]
            {REDRAW}
        [/event]
        [event]
            name=die
            first_time_only=no
            [filter]
                canrecruit=yes
            [/filter]
            [if]
                [have_unit]
                    side=1
                    canrecruit=yes
                [/have_unit]
                {NOT (
                    [have_unit]
                        side=4
                        canrecruit=yes
                    [/have_unit]
                )}
                {NOT (
                    [have_unit]
                        side=5
                        canrecruit=yes
                    [/have_unit]
                )}
                {NOT (
                    [have_unit]
                        side=6
                        canrecruit=yes
                    [/have_unit]
                )}
                {NOT (
                    [have_unit]
                        side=7
                        canrecruit=yes
                    [/have_unit]
                )}
                [then]
                    {ENDLEVEL_VICTORY yes}
                [/then]
            [/if]
        [/event]
    [/event]

    [event]
        name=victory
        [if]
            [have_unit]
                id=Althurin
            [/have_unit]
            [then]
                [store_unit]
                    [filter]
                        id=Althurin
                    [/filter]
                    variable=althurin_store
                    kill=no
                [/store_unit]
            [/then]
            [else]
                [remove_shroud]
                    side=1
                    {RECT 7 1 13 7}
                [/remove_shroud]
                [move_unit_fake]
                    type=$althurin_store.type
                    side=$althurin_store.side
                    x=11,10,13,13,12,12,14
                    y=1 ,4 ,8 ,10,10,11,12
                [/move_unit_fake]
                {VARIABLE althurin_store.x 14}
                {VARIABLE althurin_store.y 12}
                [unstore_unit]
                    variable=althurin_store
                    find_vacant=yes
                [/unstore_unit]
                # Please DO NOT clear the store's variable yet!
            [/else]
        [/if]
        {MSG_UNIT (Althurin) ( _ "Dwarf-friends, ye made it. Now, follow me to the Throne Room, King Asthorgar awaits. He'll be pleased to hear and see news of ye and yer kind again.")}
        {CLEAR_VARIABLE met_doom}
        {CLEAR_VARIABLE temp_tcx}
    [/event]

    ##################### Chest of gold at 54,29 #####################
    [item]
        x,y=54,29
        image=items/chest-plain-closed.png
    [/item]
    [event]
        name=moveto
        [filter]
            x,y=54,29
            side=1
        [/filter]
        [sound]
            name=open-chest.wav
        [/sound]
        [removeitem]
            x,y=54,29
        [/removeitem]
        [item]
            x,y=54,29
            image=items/chest-plain-open.png
        [/item]
        {REDRAW}
        [message]
            speaker=unit
            message= _ "Oh my, who could have left behind such a precious amount of gold! 190 pieces... Not bad, huh?"
        [/message]
        {RETRIEVE_GOLD 190}
    [/event]

#define __ANT _X _Y
    [unit]
        x,y={_X},{_Y}
        type=Giant Ant
        side=9
        upkeep=loyal
    [/unit]
#enddef

    # Ants 1
    [event]
        name=moveto
        [filter]
            side=1
            {RECT 31 31 34 34}
        [/filter]
        # Spawn ants in random locations
        {VARIABLE_RANDOM ant1.x 31..34}
        {VARIABLE_RANDOM ant2.x 31..34}
        {VARIABLE_RANDOM ant3.x 31..34}
        {VARIABLE_RANDOM ant1.y 31..34}
        {VARIABLE_RANDOM ant2.y 31..34}
        {VARIABLE_RANDOM ant3.y 31..34}
        {__ANT $ant1.x $ant1.y}
        {__ANT $ant2.x $ant2.y}
        {__ANT $ant3.x $ant3.y}
        {CLEAR_VARIABLE ant1}
        {CLEAR_VARIABLE ant2}
        {CLEAR_VARIABLE ant3}
        {MSG_SPEAKER unit ( _ "Ah! Giant insects!")}
        {MSG_UNIT Anlindë ( _ "Ants, but they are bigger than a tiger! What happened to them?")}
        {MSG_UNIT (Mal Keshar) ( _ "In the darkness of the depths of the world, most animals and insects grow far beyond their usual sizes. So have a care, there may be more dangerous freaks in this place.")}
        {SCROLL_TO $x1 $y1}
    [/event]

    # Ants 2
    [event]
        name=moveto
        [filter]
            side=1
            {RECT 39 24 43 26}
        [/filter]
        # Spawn ants in random locations
        {VARIABLE_RANDOM ant1.x 39..43}
        {VARIABLE_RANDOM ant2.x 39..43}
        {VARIABLE_RANDOM ant3.x 39..43}
        {VARIABLE_RANDOM ant1.y 24..26}
        {VARIABLE_RANDOM ant2.y 24..26}
        {VARIABLE_RANDOM ant3.y 24..26}
#ifdef HARD
        {VARIABLE_RANDOM ant4.x 39..43}
        {VARIABLE_RANDOM ant4.y 24..26}
        {__ANT $ant4.x $ant4.y}
        {CLEAR_VARIABLE ant4}
#endif
        {__ANT $ant1.x $ant1.y}
        {__ANT $ant2.x $ant2.y}
        {__ANT $ant3.x $ant3.y}
        {CLEAR_VARIABLE ant1}
        {CLEAR_VARIABLE ant2}
        {CLEAR_VARIABLE ant3}
        {MSG_SPEAKER unit ( _ "It must be common in these caverns to stumble on giant ants such as these...")}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=11,29
        [/filter]

        [redraw][/redraw]
        [allow_undo][/allow_undo]

        [message]
            speaker=unit
            message= _ "This coffin is empty."
        [/message]
    [/event]

#undef __ANT

#undef __EOH_UNIT

#undef __KEEP_AWAY_FROM_PRECIPICE
#undef __OPEN_WATERY_PASSAGE_1
#undef __OPEN_WATERY_PASSAGE_2
#undef __OPEN_SIDE7_NW_PASSAGE
#undef __OPEN_SIDE7_NE_PASSAGE
[/scenario]
